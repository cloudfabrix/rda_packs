{
    "name": "ai_learnings",
    "label": "AI Learnings Dashboard",
    "description": "Track and analyze AI model improvements over time",
    "enabled": true,
    "dashboard_type": "template",
    "dashboard_folder": "Default",
    "live_edit": true,
    "dashboard_style": "auto",
    "default_storyboard0": "AI Learnings",
    "dashboard_sections": [
        {
            "title": "AI Learnings",
            "show_filter": true,
            "widgets": [
                {
                    "title": "AI Learnings Dashboard",
                    "widget_type": "custom_widget",
                    "widget_implementation": "ai_learnings/ai_learnings_dashboard",
                    "min_width": 11,
                    "max_width": 11,
                    "height": 10,
                    "widget_id": "ai_learnings_dashboard",
                    "advanced": true
                }
            ]
        }
    ],
    "custom_widgets": {
        "ai_learnings_dashboard": {
            "artifacts": {
                "main": {
                    "attachment": "ai_learnings_dashboard.html",
                    "content_type": "text/html",
                    "is_template": true
                },
                "add_learning.html": {
                    "attachment": "add_learning.html",
                    "content_type": "text/html",
                    "is_template": true
                }
            }
        }
    },
    "saved_time": "2025-11-28T10:48:50.519384",
    "use_storyboard": false,
    "attachments": [
        {
            "name": "ai_learnings_dashboard.html",
            "value": "<style>\r\n    body, html {\r\n        margin: 0 !important;\r\n        padding: 0 !important;\r\n        overflow: hidden !important;\r\n    }\r\n    </style>\r\n    \r\n    <div style=\"overflow: auto; width: 100vw; height: 100vh; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #ffffff; padding: 0; margin: 0; box-sizing: border-box; font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;\">\r\n    \r\n    {# Note: request and context are not available in this dashboard framework #}\r\n    {# Therefore, we cannot call api_client.publish_to_stream() from Jinja with URL parameters #}\r\n    {# The \"Add Learning\" button will show instructions instead of directly publishing #}\r\n    \r\n    {# Query ai_learnings stream #}\r\n    {%- set learnings = engine.query_stream_data(\"ai_learnings\", cfxql_query=\"*\", sorting=[{\"timestamp\": \"desc\"}], limit=1000, max_rows=1000) -%}\r\n    \r\n    {# Query ai_personas stream #}\r\n    {%- set personas_list = engine.query_stream_data(\"ai_personas\", cfxql_query=\"*\", sorting=[{\"name\": \"asc\"}], limit=1000, max_rows=1000) -%}\r\n    \r\n    {# Calculate statistics #}\r\n    {%- set total_learnings = learnings|length if learnings else 0 -%}\r\n    \r\n    {# Get unique personas and users #}\r\n    {%- set personas_set = [] -%}\r\n    {%- set users_set = [] -%}\r\n    {%- set persona_counts = {} -%}\r\n    \r\n    {%- if learnings -%}\r\n        {%- for learning in learnings -%}\r\n            {%- set persona = (learning.get('persona', '') or '')|string -%}\r\n            {%- set user_id = (learning.get('user_id', '') or '')|string -%}\r\n            \r\n            {%- if persona and persona not in personas_set -%}\r\n                {%- set _ = personas_set.append(persona) -%}\r\n            {%- endif -%}\r\n            \r\n            {%- if user_id and user_id not in users_set -%}\r\n                {%- set _ = users_set.append(user_id) -%}\r\n            {%- endif -%}\r\n            \r\n            {# Count learnings by persona #}\r\n            {%- if persona -%}\r\n                {%- if persona in persona_counts -%}\r\n                    {%- set _ = persona_counts.update({persona: persona_counts[persona] + 1}) -%}\r\n                {%- else -%}\r\n                    {%- set _ = persona_counts.update({persona: 1}) -%}\r\n                {%- endif -%}\r\n            {%- endif -%}\r\n        {%- endfor -%}\r\n    {%- endif -%}\r\n    \r\n    {%- set unique_personas = personas_set|length -%}\r\n    {%- set unique_users = users_set|length -%}\r\n    \r\n    {# Calculate this week's learnings #}\r\n    {%- set this_week_count = 0 -%}\r\n    {%- if learnings -%}\r\n        {%- for learning in learnings -%}\r\n            {%- set timestamp = learning.get('timestamp', '') -%}\r\n            {# This will be calculated on client side for accurate time comparison #}\r\n        {%- endfor -%}\r\n    {%- endif -%}\r\n    \r\n    <!-- Main Container -->\r\n    <div style=\"padding: 30px 40px; max-width: 1600px; margin: 0 auto;\">\r\n    \r\n        <!-- Header Section -->\r\n        <div style=\"text-align: center; margin-bottom: 40px;\">\r\n            <h1 style=\"margin: 0 0 8px 0; font-size: 36px; font-weight: 700; background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 50%, #319795 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;\">\r\n                AI Learnings Dashboard\r\n            </h1>\r\n            <p style=\"margin: 0; font-size: 15px; color: #94a3b8; font-weight: 500;\">Track and analyze AI model improvements over time</p>\r\n        </div>\r\n    \r\n        <!-- Statistics Cards Grid -->\r\n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px;\">\r\n            \r\n            <!-- Total Learnings -->\r\n            <div style=\"background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%); padding: 24px; border-radius: 12px; border: 1px solid rgba(79, 209, 197, 0.3); text-align: center; box-shadow: 0 4px 20px rgba(79, 209, 197, 0.15);\">\r\n                <div style=\"color: #cbd5e1; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;\">Total Learnings</div>\r\n                <div style=\"color: #ffffff; font-size: 42px; font-weight: 700; line-height: 1;\">{{total_learnings}}</div>\r\n            </div>\r\n            \r\n            <!-- This Week -->\r\n            <div style=\"background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%); padding: 24px; border-radius: 12px; border: 1px solid rgba(79, 209, 197, 0.3); text-align: center; box-shadow: 0 4px 20px rgba(79, 209, 197, 0.15);\">\r\n                <div style=\"color: #cbd5e1; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;\">This Week</div>\r\n                <div style=\"color: #ffffff; font-size: 42px; font-weight: 700; line-height: 1;\" id=\"thisWeekCount\">0</div>\r\n                <div style=\"color: #4fd1c5; font-size: 13px; margin-top: 8px; font-weight: 500;\" id=\"thisWeekLabel\">+0 new</div>\r\n            </div>\r\n            \r\n            <!-- Personas -->\r\n            <div style=\"background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%); padding: 24px; border-radius: 12px; border: 1px solid rgba(79, 209, 197, 0.3); text-align: center; box-shadow: 0 4px 20px rgba(79, 209, 197, 0.15);\">\r\n                <div style=\"color: #cbd5e1; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;\">Personas</div>\r\n                <div style=\"color: #ffffff; font-size: 42px; font-weight: 700; line-height: 1;\">{{unique_personas}}</div>\r\n            </div>\r\n            \r\n            <!-- Contributing Users -->\r\n            <div style=\"background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%); padding: 24px; border-radius: 12px; border: 1px solid rgba(79, 209, 197, 0.3); text-align: center; box-shadow: 0 4px 20px rgba(79, 209, 197, 0.15);\">\r\n                <div style=\"color: #cbd5e1; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;\">Contributing Users</div>\r\n                <div style=\"color: #ffffff; font-size: 42px; font-weight: 700; line-height: 1;\">{{unique_users}}</div>\r\n            </div>\r\n            \r\n        </div>\r\n    \r\n        <!-- Chart Container -->\r\n        <div style=\"background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); padding: 24px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: 1px solid rgba(148, 163, 184, 0.1); margin-bottom: 30px;\">\r\n            <h3 style=\"margin: 0 0 20px 0; font-size: 20px; font-weight: 600; color: #f1f5f9;\">Learnings by Persona</h3>\r\n            <div style=\"height: 300px; position: relative;\">\r\n                <canvas id=\"personaChart\"></canvas>\r\n            </div>\r\n        </div>\r\n    \r\n        <!-- Filters Section -->\r\n        <div style=\"background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); padding: 20px 24px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: 1px solid rgba(148, 163, 184, 0.1); margin-bottom: 25px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center;\">\r\n            \r\n            <!-- Search Box -->\r\n            <div style=\"flex: 1; min-width: 250px;\">\r\n                <input \r\n                    type=\"text\" \r\n                    id=\"searchInput\" \r\n                    placeholder=\"Search learnings...\" \r\n                    style=\"width: 100%; padding: 12px 16px; border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; font-size: 14px; background: rgba(15, 23, 42, 0.6); color: #e2e8f0; outline: none;\"\r\n                    onkeyup=\"filterLearnings()\"\r\n                />\r\n            </div>\r\n            \r\n            <!-- Persona Filter -->\r\n            <select \r\n                id=\"personaFilter\" \r\n                style=\"padding: 12px 16px; border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; font-size: 14px; background: rgba(15, 23, 42, 0.6); color: #e2e8f0; cursor: pointer; outline: none;\"\r\n                onchange=\"filterLearnings()\"\r\n            >\r\n                <option value=\"all\">All Personas</option>\r\n                {%- for persona in personas_set|sort -%}\r\n                <option value=\"{{persona}}\">{{persona}}</option>\r\n                {%- endfor -%}\r\n            </select>\r\n            \r\n            <!-- User Filter -->\r\n            <select \r\n                id=\"userFilter\" \r\n                style=\"padding: 12px 16px; border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; font-size: 14px; background: rgba(15, 23, 42, 0.6); color: #e2e8f0; cursor: pointer; outline: none;\"\r\n                onchange=\"filterLearnings()\"\r\n            >\r\n                <option value=\"all\">All Users</option>\r\n                {%- for user in users_set|sort -%}\r\n                <option value=\"{{user}}\">{{user}}</option>\r\n                {%- endfor -%}\r\n            </select>\r\n            \r\n        </div>\r\n    \r\n        <!-- Learnings List -->\r\n        <div style=\"background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: 1px solid rgba(148, 163, 184, 0.1); overflow: hidden;\">\r\n            \r\n            <!-- List Header -->\r\n            <div style=\"padding: 20px 24px; border-bottom: 1px solid rgba(148, 163, 184, 0.1); display: flex; align-items: center; justify-content: space-between;\">\r\n                <h3 style=\"margin: 0; font-size: 20px; font-weight: 600; color: #f1f5f9;\">\r\n                    Recent Learnings <span id=\"learningCount\" style=\"color: #64748b; font-size: 16px; font-weight: 400;\">({{total_learnings}})</span>\r\n                </h3>\r\n                <button onclick=\"openAddLearningModal()\" style=\"background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%); color: #ffffff; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(79, 209, 197, 0.3); transition: all 0.2s;\"\r\n                        onmouseover=\"this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(79, 209, 197, 0.4)'\"\r\n                        onmouseout=\"this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(79, 209, 197, 0.3)'\">\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                        <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\r\n                        <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\r\n                    </svg>\r\n                    Add Learning\r\n                </button>\r\n            </div>\r\n            \r\n            <!-- Learnings Items Container -->\r\n            <div id=\"learningsContainer\">\r\n                {%- if learnings and learnings|length > 0 -%}\r\n                    {%- for learning in learnings -%}\r\n                        {%- set persona = (learning.get('persona', 'Unknown') or 'Unknown')|string -%}\r\n                        {%- set user_id = (learning.get('user_id', 'Unknown') or 'Unknown')|string -%}\r\n                        {%- set learning_summary = (learning.get('learning_summary', '') or '')|string -%}\r\n                        {%- set timestamp = (learning.get('timestamp', '') or '')|string -%}\r\n                        \r\n                        <!-- Learning Item -->\r\n                        <div class=\"learning-item\" data-persona=\"{{persona|lower}}\" data-user=\"{{user_id}}\" data-summary=\"{{learning_summary|lower}}\" style=\"padding: 20px 24px; border-bottom: 1px solid rgba(148, 163, 184, 0.1); transition: background 0.2s;\"\r\n                             onmouseover=\"this.style.background='rgba(15, 23, 42, 0.4)'\"\r\n                             onmouseout=\"this.style.background='transparent'\">\r\n                            \r\n                            <!-- Meta Information -->\r\n                            <div style=\"display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;\">\r\n                                \r\n                                <!-- Persona Badge -->\r\n                                <span class=\"persona-text\" style=\"display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: rgba(79, 209, 197, 0.15); color: #4fd1c5; border: 1px solid rgba(79, 209, 197, 0.3);\">\r\n                                    {{persona}}\r\n                                </span>\r\n                                \r\n                                <!-- User Badge -->\r\n                                <span style=\"display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3);\">\r\n                                    {{user_id}}\r\n                                </span>\r\n                                \r\n                                <!-- Date Badge -->\r\n                                <span class=\"date-badge\" data-timestamp=\"{{timestamp}}\" style=\"display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: rgba(139, 92, 246, 0.15); color: #a78bfa; border: 1px solid rgba(139, 92, 246, 0.3);\">\r\n                                    {{timestamp}}\r\n                                </span>\r\n                                \r\n                            </div>\r\n                            \r\n                            <!-- Learning Summary -->\r\n                            <div class=\"summary-text\" style=\"color: #cbd5e1; font-size: 14px; line-height: 1.6;\">\r\n                                {{learning_summary}}\r\n                            </div>\r\n                            \r\n                        </div>\r\n                    {%- endfor -%}\r\n                {%- else -%}\r\n                    <!-- Empty State -->\r\n                    <div style=\"text-align: center; padding: 60px 40px; color: #64748b;\">\r\n                        <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"margin-bottom: 16px; opacity: 0.5;\">\r\n                            <path d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                        </svg>\r\n                        <p style=\"font-size: 16px;\">No learnings found matching your filters</p>\r\n                    </div>\r\n                {%- endif -%}\r\n            </div>\r\n            \r\n            <!-- Empty State Template (hidden by default) -->\r\n            <div id=\"emptyState\" style=\"display: none; text-align: center; padding: 60px 40px; color: #64748b;\">\r\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"margin-bottom: 16px; opacity: 0.5;\">\r\n                    <path d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                </svg>\r\n                <p style=\"font-size: 16px;\">No learnings found matching your filters</p>\r\n            </div>\r\n            \r\n        </div>\r\n    \r\n    </div>\r\n    \r\n    </div>\r\n    \r\n    <!-- Add Learning Modal -->\r\n    <div id=\"addLearningModal\" style=\"display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center;\">\r\n        <div style=\"background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 16px; padding: 32px; max-width: 600px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 1px solid rgba(79, 209, 197, 0.3); position: relative;\">\r\n            \r\n            <!-- Close Button -->\r\n            <button onclick=\"closeAddLearningModal()\" style=\"position: absolute; top: 16px; right: 16px; background: transparent; border: none; color: #94a3b8; cursor: pointer; padding: 8px; border-radius: 6px; transition: all 0.2s;\"\r\n                    onmouseover=\"this.style.background='rgba(148, 163, 184, 0.1)'; this.style.color='#f1f5f9'\"\r\n                    onmouseout=\"this.style.background='transparent'; this.style.color='#94a3b8'\">\r\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                    <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n                    <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n                </svg>\r\n            </button>\r\n            \r\n            <!-- Modal Header -->\r\n            <h2 style=\"margin: 0 0 8px 0; font-size: 24px; font-weight: 700; color: #f1f5f9; font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;\">Add New Learning</h2>\r\n            <p style=\"margin: 0 0 24px 0; color: #94a3b8; font-size: 14px; font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;\">Capture a new AI learning insight</p>\r\n            \r\n            <!-- Form -->\r\n            <form id=\"addLearningForm\" onsubmit=\"submitLearning(event); return false;\">\r\n                \r\n                <!-- Persona Field -->\r\n                <div style=\"margin-bottom: 20px;\">\r\n                    <label for=\"personaInput\" style=\"display: block; color: #cbd5e1; font-size: 14px; font-weight: 600; margin-bottom: 8px; font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;\">Persona *</label>\r\n                    <select \r\n                        id=\"personaInput\"\r\n                        required \r\n                        style=\"width: 100%; padding: 12px 16px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #e2e8f0; font-size: 14px; outline: none; transition: all 0.2s; font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; cursor: pointer;\"\r\n                        onfocus=\"this.style.borderColor='rgba(79, 209, 197, 0.5)'\"\r\n                        onblur=\"this.style.borderColor='rgba(148, 163, 184, 0.2)'\"\r\n                    >\r\n                        <option value=\"\" disabled selected>Select a persona...</option>\r\n                        {%- if personas_list and personas_list|length > 0 -%}\r\n                            {%- for persona_item in personas_list -%}\r\n                                {%- set persona_name = (persona_item.get('name', '') or '')|string -%}\r\n                                {%- if persona_name -%}\r\n                                <option value=\"{{persona_name}}\">{{persona_name}}</option>\r\n                                {%- endif -%}\r\n                            {%- endfor -%}\r\n                        {%- else -%}\r\n                            <option value=\"\" disabled>No personas available</option>\r\n                        {%- endif -%}\r\n                    </select>\r\n                </div>\r\n                \r\n                <!-- Learning Summary Field -->\r\n                <div style=\"margin-bottom: 24px;\">\r\n                    <label for=\"summaryInput\" style=\"display: block; color: #cbd5e1; font-size: 14px; font-weight: 600; margin-bottom: 8px; font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;\">Learning Summary *</label>\r\n                    <textarea \r\n                        id=\"summaryInput\"\r\n                        required \r\n                        rows=\"4\"\r\n                        placeholder=\"Describe the learning insight...\"\r\n                        style=\"width: 100%; padding: 12px 16px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #e2e8f0; font-size: 14px; outline: none; resize: vertical; font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; transition: all 0.2s;\"\r\n                        onfocus=\"this.style.borderColor='rgba(79, 209, 197, 0.5)'\"\r\n                        onblur=\"this.style.borderColor='rgba(148, 163, 184, 0.2)'\"\r\n                    ></textarea>\r\n                </div>\r\n                \r\n                <!-- Form Actions -->\r\n                <div style=\"display: flex; gap: 12px; justify-content: flex-end;\">\r\n                    <button \r\n                        type=\"button\" \r\n                        onclick=\"closeAddLearningModal()\" \r\n                        style=\"padding: 10px 20px; background: rgba(148, 163, 184, 0.1); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #cbd5e1; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;\"\r\n                        onmouseover=\"this.style.background='rgba(148, 163, 184, 0.2)'\"\r\n                        onmouseout=\"this.style.background='rgba(148, 163, 184, 0.1)'\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button \r\n                        type=\"submit\" \r\n                        style=\"padding: 10px 20px; background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%); border: none; border-radius: 8px; color: #ffffff; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(79, 209, 197, 0.3); transition: all 0.2s;\"\r\n                        onmouseover=\"this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(79, 209, 197, 0.4)'\"\r\n                        onmouseout=\"this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(79, 209, 197, 0.3)'\"\r\n                    >\r\n                        Add Learning\r\n                    </button>\r\n                </div>\r\n                \r\n            </form>\r\n            \r\n        </div>\r\n    </div>\r\n    \r\n    <!-- Include Chart.js from CDN -->\r\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js\"></script>\r\n    \r\n    <script>\r\n    // Store learnings data for client-side filtering\r\n    const allLearnings = [\r\n        {%- if learnings -%}\r\n            {%- for learning in learnings -%}\r\n                {\r\n                    persona: \"{{(learning.get('persona', 'Unknown') or 'Unknown')|string}}\",\r\n                    user_id: \"{{(learning.get('user_id', 'Unknown') or 'Unknown')|string}}\",\r\n                    learning_summary: \"{{(learning.get('learning_summary', '') or '')|string|replace('\"', '\\\\\"')}}\",\r\n                    timestamp: \"{{(learning.get('timestamp', '') or '')|string}}\"\r\n                }{%- if not loop.last -%},{%- endif -%}\r\n            {%- endfor -%}\r\n        {%- endif -%}\r\n    ];\r\n    \r\n    // Format date to relative time\r\n    function formatDate(dateString) {\r\n        if (!dateString) return 'Unknown';\r\n        \r\n        try {\r\n            const date = new Date(dateString);\r\n            \r\n            // Check if date is valid\r\n            if (isNaN(date.getTime())) {\r\n                return dateString;\r\n            }\r\n            \r\n            const now = new Date();\r\n            const diffTime = now - date;\r\n            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));\r\n            const diffMinutes = Math.floor(diffTime / (1000 * 60));\r\n            \r\n            // Handle future dates\r\n            if (diffTime < 0) {\r\n                const options = { month: 'short', day: 'numeric', year: 'numeric' };\r\n                return date.toLocaleDateString('en-US', options);\r\n            }\r\n            \r\n            // Less than 1 minute\r\n            if (diffMinutes < 1) return 'Just now';\r\n            \r\n            // Less than 1 hour\r\n            if (diffMinutes < 60) return diffMinutes + ' minute' + (diffMinutes === 1 ? '' : 's') + ' ago';\r\n            \r\n            // Less than 24 hours\r\n            if (diffHours < 24) return diffHours + ' hour' + (diffHours === 1 ? '' : 's') + ' ago';\r\n            \r\n            // 1 day\r\n            if (diffDays === 1) return 'Yesterday';\r\n            \r\n            // Less than 7 days\r\n            if (diffDays < 7) return diffDays + ' days ago';\r\n            \r\n            // Less than 30 days\r\n            if (diffDays < 30) {\r\n                const weeks = Math.floor(diffDays / 7);\r\n                return weeks + ' week' + (weeks === 1 ? '' : 's') + ' ago';\r\n            }\r\n            \r\n            // More than 30 days - show formatted date\r\n            const options = { month: 'short', day: 'numeric', year: 'numeric' };\r\n            return date.toLocaleDateString('en-US', options);\r\n        } catch (e) {\r\n            return dateString;\r\n        }\r\n    }\r\n    \r\n    // Calculate this week's learnings\r\n    function calculateThisWeek() {\r\n        const now = new Date();\r\n        const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        \r\n        let count = 0;\r\n        allLearnings.forEach(learning => {\r\n            if (learning.timestamp) {\r\n                const learningDate = new Date(learning.timestamp);\r\n                if (learningDate > sevenDaysAgo) {\r\n                    count++;\r\n                }\r\n            }\r\n        });\r\n        \r\n        document.getElementById('thisWeekCount').textContent = count;\r\n        document.getElementById('thisWeekLabel').textContent = '+' + count + ' new';\r\n    }\r\n    \r\n    // Initialize date badges\r\n    function initializeDateBadges() {\r\n        const dateBadges = document.querySelectorAll('.date-badge');\r\n        dateBadges.forEach(badge => {\r\n            const timestamp = badge.getAttribute('data-timestamp');\r\n            badge.textContent = formatDate(timestamp);\r\n        });\r\n    }\r\n    \r\n    // Filter learnings based on search and filters\r\n    function filterLearnings() {\r\n        const searchTerm = document.getElementById('searchInput').value.toLowerCase();\r\n        const personaFilter = document.getElementById('personaFilter').value.toLowerCase();\r\n        const userFilter = document.getElementById('userFilter').value;\r\n        \r\n        const learningItems = document.querySelectorAll('.learning-item');\r\n        let visibleCount = 0;\r\n        \r\n        learningItems.forEach(item => {\r\n            const persona = item.getAttribute('data-persona');\r\n            const user = item.getAttribute('data-user');\r\n            const summary = item.getAttribute('data-summary');\r\n            \r\n            // Search matches both persona and summary\r\n            const matchesSearch = searchTerm === '' || summary.includes(searchTerm) || persona.includes(searchTerm);\r\n            const matchesPersona = personaFilter === 'all' || persona === personaFilter;\r\n            const matchesUser = userFilter === 'all' || user === userFilter;\r\n            \r\n            if (matchesSearch && matchesPersona && matchesUser) {\r\n                item.style.display = 'block';\r\n                visibleCount++;\r\n            } else {\r\n                item.style.display = 'none';\r\n            }\r\n        });\r\n        \r\n        // Update count\r\n        document.getElementById('learningCount').textContent = '(' + visibleCount + ')';\r\n        \r\n        // Show/hide empty state\r\n        const container = document.getElementById('learningsContainer');\r\n        const emptyState = document.getElementById('emptyState');\r\n        \r\n        if (visibleCount === 0 && learningItems.length > 0) {\r\n            // Hide all items and show empty state\r\n            learningItems.forEach(item => item.style.display = 'none');\r\n            if (emptyState) {\r\n                emptyState.style.display = 'block';\r\n            }\r\n        } else if (emptyState) {\r\n            emptyState.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    // Initialize Chart.js bar chart\r\n    function initializeChart() {\r\n        const ctx = document.getElementById('personaChart');\r\n        if (!ctx) return;\r\n        \r\n        // Prepare data from server-side\r\n        const personaCounts = {{persona_counts|tojson|safe}};\r\n        const labels = Object.keys(personaCounts).sort();\r\n        const data = labels.map(label => personaCounts[label]);\r\n        \r\n        new Chart(ctx, {\r\n            type: 'bar',\r\n            data: {\r\n                labels: labels,\r\n                datasets: [{\r\n                    label: 'Learnings by Persona',\r\n                    data: data,\r\n                    backgroundColor: 'rgba(79, 209, 197, 0.7)',\r\n                    borderColor: 'rgba(79, 209, 197, 1)',\r\n                    borderWidth: 1,\r\n                    borderRadius: 6\r\n                }]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                maintainAspectRatio: false,\r\n                scales: {\r\n                    y: {\r\n                        beginAtZero: true,\r\n                        ticks: {\r\n                            stepSize: 1,\r\n                            color: '#94a3b8'\r\n                        },\r\n                        grid: {\r\n                            color: 'rgba(148, 163, 184, 0.1)'\r\n                        }\r\n                    },\r\n                    x: {\r\n                        ticks: {\r\n                            color: '#94a3b8'\r\n                        },\r\n                        grid: {\r\n                            display: false\r\n                        }\r\n                    }\r\n                },\r\n                plugins: {\r\n                    legend: {\r\n                        display: false\r\n                    },\r\n                    tooltip: {\r\n                        backgroundColor: 'rgba(15, 23, 42, 0.9)',\r\n                        titleColor: '#f1f5f9',\r\n                        bodyColor: '#cbd5e1',\r\n                        borderColor: 'rgba(79, 209, 197, 0.3)',\r\n                        borderWidth: 1,\r\n                        padding: 12,\r\n                        cornerRadius: 8\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Modal functions\r\n    function openAddLearningModal() {\r\n        const modal = document.getElementById('addLearningModal');\r\n        modal.style.display = 'flex';\r\n    }\r\n    \r\n    function closeAddLearningModal() {\r\n        const modal = document.getElementById('addLearningModal');\r\n        modal.style.display = 'none';\r\n        document.getElementById('addLearningForm').reset();\r\n    }\r\n    \r\n    // Close modal when clicking outside\r\n    document.addEventListener('click', function(event) {\r\n        const modal = document.getElementById('addLearningModal');\r\n        if (event.target === modal) {\r\n            closeAddLearningModal();\r\n        }\r\n    });\r\n    \r\n    // Submit learning function\r\n    function submitLearning(event) {\r\n        event.preventDefault();\r\n\r\n        const persona = document.getElementById('personaInput').value;\r\n        const learning_summary = document.getElementById('summaryInput').value;\r\n        const user_id = \"{{ USER_ID }}\";\r\n\r\n        const myObject = {persona, learning_summary, user_id}\r\n        const jsonString = JSON.stringify(myObject);\r\n        const base64EncodedString = btoa(jsonString);\r\n\r\n        fetch(\"add_learning.html?query=\" + base64EncodedString)\r\n        \r\n        // Close modal\r\n        closeAddLearningModal();\r\n    }\r\n    \r\n    // Initialize on page load\r\n    document.addEventListener('DOMContentLoaded', function() {\r\n        initializeDateBadges();\r\n        calculateThisWeek();\r\n        initializeChart();\r\n    });\r\n    </script>\r\n    ",
            "additionalFields": {
                "valueType": "",
                "description": ""
            }
        },
        {
            "name": "add_learning.html",
            "value": "\n{%- set _ = api_client.publish_to_stream(\"ai_learnings\", message=query) -%}",
            "additionalFields": {
                "valueType": "",
                "description": ""
            }
        }
    ]
}