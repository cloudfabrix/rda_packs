{
  "name": "ai_fabaio_output",
  "label": "Fabaio Output",
  "is_template": false,
  "description": "AI Fabaio Job Details",
  "live_edit": true,
  "version": "25.7.8.1",
  "enabled": true,
  "dashboard_folder": "Fabaio",
  "dashboard_type": "template",
  "use_storyboard": false,
  "default_storyboard": null,
  "template_variables": {
      "JOB_ID": {
          "contextId": "conversationId"
      },
      "FLOW_NAME": {
          "contextId": "conversationLabel"
      }
  },
  "dashboard_filters": {},
  "dashboard_sections": [
      {
          "title": "Output",
          "widgets": [
              {
                  "title": "Workflow View",
                  "widget_type": "label",
                  "label": "attachment://fabaio_output",
                  "advanced": false,
                  "uses_reporting_engine": true,
                  "fixed_variables": {
                      "conversation_name": "{{FLOW_NAME}}",
                      "job_id": "{{JOB_ID}}"
                  },
                  "widget_id": "accfc497",
                  "min_width": 12,
                  "max_width": 12,
                  "height": 8
              }
          ]
      }
  ],
  "saved_time": "2025-11-05T15:18:24.255605",
  "attachments": [
      {
          "name": "fabaio_output_old",
          "value": "\n<div style=\"overflow: auto;\">\n\n{% if conversation_name is not defined or not conversation_name %}\n  <h3 style=\"color: red;\">\u26a0\ufe0f Error: Conversation Name not found. Cannot display chat output.</h3>\n{% else %}\n\n  {# --- Query for final chat message --- #}\n  {% set query = \"conversationId = '\" ~ context.conversationId ~ \"' and final_response = true\" %}\n  {% set ns = namespace(chat_output=\"\", last_updated=\"\") %}\n\n  {% set data = engine.query_stream_data(\n      \"rda_chat_sessions\",\n      cfxql_query=query,\n      sorting=[{\"timestamp\": \"desc\"}]\n  ) %}\n\n  {% if data and data|length > 0 and data[0] is mapping %}\n      {% set ns.last_updated = data[0].get(\"timestamp\", \"\") %}\n  {% endif %}\n\n  {% if data and data|length > 0 %}\n      {% for row in data %}\n          {% if row and row is mapping %}\n              {% set num_parts_raw = row.get(\"message_num_parts\") %}\n              {% if num_parts_raw is string %}\n                  {% set num_parts = num_parts_raw | int %}\n              {% else %}\n                  {% set num_parts = num_parts_raw or 0 %}\n              {% endif %}\n\n              {% set output_buffer = \"\" %}\n\n              {% if num_parts > 0 %}\n                  {% for i in range(0, num_parts) %}\n                      {% set key = \"message\" if i == 0 else \"message_\" ~ i %}\n                      {% set part = row.get(key) %}\n                      {% if part %}\n                          {% set cleaned = part\n                              | replace(\"```html\", \"\")\n                              | replace(\"```\", \"\")\n                              | trim\n                          %}\n                          {% set output_buffer = output_buffer + cleaned %}\n                      {% endif %}\n                  {% endfor %}\n              {% elif row.get(\"message\") %}\n                  {% set output_buffer = row.get(\"message\")\n                      | replace(\"```html\", \"\")\n                      | replace(\"```\", \"\")\n                      | trim\n                  %}\n              {% endif %}\n\n              {% if output_buffer %}\n                  {% set ns.chat_output = output_buffer %}\n              {% endif %}\n          {% endif %}\n      {% endfor %}\n  {% endif %}\n\n  <h3 style=\"margin-bottom: 5px;\">\ud83d\uddc2\ufe0f {{ conversation_name }}</h3>\n  <p style=\"font-size: 0.9em; color: #888; margin-top: 0;\">Last Updated: {{ ns.last_updated }}</p>\n\n  {# --- Collapsible Debug Section --- #}\n  <details style=\"margin-bottom: 10px;\">\n      <summary style=\"cursor: pointer; color: #0f0;\">Show Debug (Raw Message)</summary>\n      <div style=\"max-height: 250px; overflow: auto; background-color: #000; color: #0f0; padding: 10px; border-radius: 8px; font-family: monospace; white-space: pre-wrap;\">\n          {{ ns.chat_output | e }}\n      </div>\n  </details>\n\n  <hr style=\"border-color: #333;\"/>\n  <div style=\"max-height: 80vh; overflow: auto; background-color: #111; color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #000;\">\n      {{ ns.chat_output | safe }}\n  </div>\n\n{% endif %}\n</div>\n"
      },
      {
          "name": "fabaio_output",
          "value": "{% raw %}\n<div>\n\n{% if context.conversationLabel is not defined or not context.conversationLabel %}\n    <h3 style=\"color: red;\">\u26a0\ufe0f Error: Conversation Label not found. Cannot display chat output.</h3>\n{% else %}\n\n    {% set conversation_name = context.conversationLabel %}\n    {% set query = \"conversationId = '\" ~ context.conversationId ~ \"' and final_response = true\" %}\n    {% set ns = namespace(chat_output=\"\") %}\n\n    {% set data = engine.query_stream_data(\n        \"rda_chat_sessions\",\n        cfxql_query=query,\n        sorting=[{\"timestamp\": \"desc\"}]\n    ) %}\n\n    {% if data and data|length > 0 and data[0] and data[0] is mapping %}\n        {% set row = data[0] %}\n\n        {% set num_parts_raw = row.get(\"message_num_parts\") %}\n        {% if num_parts_raw is string %}\n            {% set num_parts = num_parts_raw | int %}\n        {% else %}\n            {% set num_parts = num_parts_raw or 0 %}\n        {% endif %}\n\n        {% set output_buffer = \"\" %}\n\n        {% if num_parts > 0 %}\n            {% for i in range(0, num_parts) %}\n                {% if i == 0 %}\n                    {% set key = \"message\" %}\n                {% else %}\n                    {% set key = \"message_\" ~ i %}\n                {% endif %}\n                {% set part = row.get(key) %}\n                {% if part %}\n                    {% if i == 0 %}\n                        {% set cleaned_first = part\n                            | replace(\"```html\", \"\")\n                            | replace(\"```\", \"\")\n                            | trim\n                        %}\n\n                        {% set output_buffer = output_buffer + cleaned_first %}\n                    {% else %}\n                        {% set output_buffer = output_buffer + part %}\n                    {% endif %}\n                {% endif %}\n            {% endfor %}\n            {% set ns.chat_output = output_buffer %}\n        {% elif row.get(\"message\") %}\n            {% set ns.chat_output = row.get(\"message\")\n                | replace(\"```html\", \"\")\n                | replace(\"```\", \"\")\n                | trim\n            %}\n        {% endif %}\n    {% endif %}\n\n\n\n    <div style=\"\n        max-height: 80vh;\n        overflow-y: auto;\n        padding: 15px;\n        border-radius: 10px;\n        width: 100%;\n        display: block;\n        height: auto;\n    \">\n        {{ ns.chat_output | safe }}\n    </div>\n\n    {% if not ns.chat_output %}\n        <p style=\"color:gray;\">\u2139\ufe0f No output available for this conversation.</p>\n    {% endif %}\n\n{% endif %}\n</div>\n{% endraw %}"
      }
  ]
}