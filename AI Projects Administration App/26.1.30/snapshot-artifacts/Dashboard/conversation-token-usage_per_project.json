{
    "name": "conversation-token-usage_per_project",
    "label": "Monitor Conversations",
    "description": "Token Usage: Insights",
    "dashboard_folder": "AI",
    "version": "1.0.1",
    "enabled": false,
    "stream": "rda_chat_sessions",
    "dashboard_type": "template",
    "live_edit": true,
    "template_variables": {
        "ai_project_name": {
            "contextId": "ai_project_name"
        }
    },
    "dashboard_filters": {
        "time_filter": true,
        "default_time_filter_labels": [
            "All Time"
        ],
        "columns_filter": [
            {
                "id": "timestamp",
                "label": "Timestamp",
                "type": "DATETIME"
            },
            {
                "id": "USER_ID",
                "label": "User Id",
                "type": "TEXT"
            },
            {
                "id": "context_USER_ID",
                "label": "Context User Id",
                "type": "TEXT"
            },
            {
                "id": "context_USER_ROLE",
                "label": "Context User Role",
                "type": "TEXT"
            },
            {
                "id": "context_approver_userid",
                "label": "Context Approver Userid",
                "type": "TEXT"
            },
            {
                "id": "context_incidentid",
                "label": "Context Incidentid",
                "type": "TEXT"
            },
            {
                "id": "conversationId",
                "label": "Conversationid",
                "type": "TEXT"
            },
            {
                "id": "conversationLabel",
                "label": "Conversationlabel",
                "type": "TEXT"
            },
            {
                "id": "isToolCall",
                "label": "Istoolcall",
                "type": "TEXT"
            },
            {
                "id": "llm",
                "label": "Llm",
                "type": "TEXT"
            },
            {
                "id": "llm_name",
                "label": "Llm Name",
                "type": "TEXT"
            },
            {
                "id": "message",
                "label": "Message",
                "type": "TEXT"
            },
            {
                "id": "persona",
                "label": "Persona",
                "type": "TEXT"
            },
            {
                "id": "prompt_id",
                "label": "Prompt Id",
                "type": "TEXT"
            },
            {
                "id": "request_status",
                "label": "Request Status",
                "type": "TEXT"
            },
            {
                "id": "request_subtype",
                "label": "Request Subtype",
                "type": "TEXT"
            },
            {
                "id": "request_type",
                "label": "Request Type",
                "type": "TEXT"
            },
            {
                "id": "severity",
                "label": "Severity",
                "type": "TEXT"
            },
            {
                "id": "tool_content",
                "label": "Tool Content",
                "type": "TEXT"
            },
            {
                "id": "tool_domain",
                "label": "Tool Domain",
                "type": "TEXT"
            },
            {
                "id": "tool_name",
                "label": "Tool Name",
                "type": "TEXT"
            },
            {
                "id": "tool_status",
                "label": "Tool Status",
                "type": "TEXT"
            },
            {
                "id": "type",
                "label": "Type",
                "type": "TEXT"
            },
            {
                "id": "token_usage_cache_tokens",
                "label": "Token Usage Cache Tokens",
                "type": "DOUBLE"
            },
            {
                "id": "token_usage_input_tokens",
                "label": "Token Usage Input Tokens",
                "type": "DOUBLE"
            },
            {
                "id": "token_usage_output_tokens",
                "label": "Token Usage Output Tokens",
                "type": "DOUBLE"
            },
            {
                "id": "token_usage_reasoning_tokens",
                "label": "Token Usage Reasoning Tokens",
                "type": "DOUBLE"
            },
            {
                "id": "token_usage_total_tokens",
                "label": "Token Usage Total Tokens",
                "type": "DOUBLE"
            }
        ],
        "group_filters": [
            {
                "stream": "rda_chat_sessions",
                "title": "LLM",
                "duration_hours": 1080,
                "limit": 200,
                "extra_filter": "type == 'client'",
                "group_by": [
                    "llm"
                ],
                "ts_column": "timestamp",
                "agg": "sum",
                "column": "count_",
                "type": "int"
            },
            {
                "stream": "rda_chat_sessions",
                "title": "User",
                "duration_hours": 1080,
                "limit": 200,
                "extra_filter": "type == 'client'",
                "group_by": [
                    "USER_ID"
                ],
                "ts_column": "timestamp",
                "agg": "sum",
                "column": "count_",
                "type": "int"
            },
            {
                "stream": "rda_chat_sessions",
                "title": "Persona",
                "duration_hours": 1080,
                "limit": 200,
                "extra_filter": "type == 'client'",
                "group_by": [
                    "persona"
                ],
                "ts_column": "timestamp",
                "agg": "sum",
                "column": "count_",
                "type": "int"
            }
        ]
    },
    "dashboard_sections": [
        {
            "title": "Monitor Token Usage",
            "show_filter": true,
            "widgets": [
                {
                    "widget_type": "label",
                    "label": "<div style='text-align:center;width:100%;'><h1><a style='text-decoration:none;' target='_blank'> Project : {{ai_project_name}} </a></h1></div>",
                    "min_width": 12,
                    "widget_id": "4b1867d9"
                },
                {
                    "widget_type_!!!": "label",
                    "height": 2,
                    "min_width": 12,
                    "label": "<div style='width: 100%; height: 100%; color: light-dark(#ffffff, #000000); background-color: light-dark(#000000, #ffffff);'>Hello World</div>",
                    "widget_id": "07729d0f"
                },
                {
                    "title": "Fabaio",
                    "widget_type": "tabular",
                    "duration_hours": 1080,
                    "widget_group": "G0",
                    "max_width": 12,
                    "height": 8,
                    "min_width": 12,
                    "stream": "rda_chat_sessions",
                    "ts_column": "timestamp",
                    "extra_filter": "request_type is 'Copilot' and ai_project_name is '{{ai_project_name}}'",
                    "columns": {
                        "USER_ID": {
                            "title": "User",
                            "type": "TEXT",
                            "hidden": false
                        },
                        "llm": {
                            "title": "LLM",
                            "type": "TEXT",
                            "hidden": false
                        },
                        "persona": {
                            "title": "Persona",
                            "type": "TEXT",
                            "hidden": false
                        },
                        "ai_project_name": {
                            "title": "AI Project Name",
                            "type": "TEXT",
                            "hidden": true
                        }
                    },
                    "pivot": {
                        "pivot_type": "advanced",
                        "group_by": [
                            "USER_ID",
                            "llm",
                            "persona",
                            "ai_project_name"
                        ],
                        "series": [
                            {
                                "column": "token_usage_input_tokens",
                                "agg": "avg",
                                "type": "int",
                                "label": "Input Tokens"
                            },
                            {
                                "column": "token_usage_output_tokens",
                                "agg": "avg",
                                "type": "int",
                                "label": "Output Tokens"
                            },
                            {
                                "column": "token_usage_cache_tokens",
                                "agg": "avg",
                                "type": "int",
                                "label": "Cache Tokens"
                            }
                        ]
                    },
                    "widget_id": "3c025874"
                },
                {
                    "title": "Agents",
                    "widget_type": "tabular",
                    "duration_hours": 1080,
                    "widget_group": "G0",
                    "max_width": 12,
                    "height": 8,
                    "min_width": 12,
                    "stream": "rda_chat_sessions",
                    "ts_column": "timestamp",
                    "extra_filter": "request_type is 'Agent' and ai_project_name is '{{ai_project_name}}'",
                    "columns": {
                        "USER_ID": {
                            "title": "User",
                            "type": "TEXT",
                            "hidden": false
                        },
                        "llm": {
                            "title": "LLM",
                            "type": "TEXT",
                            "hidden": false
                        },
                        "persona": {
                            "title": "Persona",
                            "type": "TEXT",
                            "hidden": false
                        },
                        "ai_project_name": {
                            "title": "AI Project Name",
                            "type": "TEXT",
                            "hidden": true
                        }
                    },
                    "pivot": {
                        "pivot_type": "advanced",
                        "group_by": [
                            "USER_ID",
                            "llm",
                            "persona"
                        ],
                        "series": [
                            {
                                "column": "token_usage_input_tokens",
                                "agg": "avg",
                                "type": "int",
                                "label": "Input Tokens"
                            },
                            {
                                "column": "token_usage_output_tokens",
                                "agg": "avg",
                                "type": "int",
                                "label": "Output Tokens"
                            },
                            {
                                "column": "token_usage_cache_tokens",
                                "agg": "avg",
                                "type": "int",
                                "label": "Cache Tokens"
                            }
                        ]
                    },
                    "widget_id": "79e90e3e"
                }
            ]
        }
    ],
    "saved_time": "2025-10-16T13:39:54.882800",
    "attachments": [
        {
            "name": "token_count_bkp",
            "value": "{% raw %}\r\n{# ---- Query Aggregates ---- #}\r\n{% set input_data = engine.query_stream_aggs(\r\n    stream=\"rda_chat_sessions\",\r\n    aggs=[{\"field\": \"token_usage_input_tokens\", \"func\": \"avg\"}],\r\n    groupby=[\"request_type\",\"USER_ID\"],\r\n    duration_hours=1800000,\r\n    ts_column=\"timestamp\"\r\n) %}\r\n\r\n{% set output_data = engine.query_stream_aggs(\r\n    stream=\"rda_chat_sessions\",\r\n    aggs=[{\"field\": \"token_usage_output_tokens\", \"func\": \"avg\"}],\r\n    groupby=[\"request_type\",\"llm\",\"persona\"],\r\n    duration_hours=1800000,\r\n    ts_column=\"timestamp\"\r\n) %}\r\n\r\n{% set cache_data = engine.query_stream_aggs(\r\n    stream=\"rda_chat_sessions\",\r\n    aggs=[{\"field\": \"token_usage_cache_tokens\", \"func\": \"avg\"}],\r\n    groupby=[\"request_type\",\"llm\",\"persona\"],\r\n    duration_hours=1800000,\r\n    ts_column=\"timestamp\"\r\n) %}\r\n\r\n{# ---- Extract only Workflow(Agent) and Copilot ---- #}\r\n{% set workflow_input = (input_data | selectattr(\"request_type\", \"equalto\", \"Agent\") | list) %}\r\n{% set workflow_output = (output_data | selectattr(\"request_type\", \"equalto\", \"Agent\") | list) %}\r\n{% set workflow_cache = (cache_data | selectattr(\"request_type\", \"equalto\", \"Agent\") | list) %}\r\n\r\n{% set copilot_input = (input_data | selectattr(\"request_type\", \"equalto\", \"Copilot\") | list) %}\r\n{% set copilot_output = (output_data | selectattr(\"request_type\", \"equalto\", \"Copilot\") | list) %}\r\n{% set copilot_cache = (cache_data | selectattr(\"request_type\", \"equalto\", \"Copilot\") | list) %}\r\n\r\n<div style=\"font-family: Arial, sans-serif; font-size: 14px; margin: 10px;\">\r\n\r\n  <div style=\"display: flex; gap: 16px; flex-wrap: wrap; background:#1e293b; padding:16px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.3); max-height: 240px;\">\r\n    \r\n    <!-- Workflow Card -->\r\n    <div style=\"flex:1; background:#111827; padding:14px; border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,0.5);\">\r\n      <h3 style=\"margin-top:0; color:#f8fafc; font-size:16px; text-align:center;\">Average Tokens for Workflow</h3>\r\n      <div style=\"display: flex; gap: 10px;\">\r\n        <div style=\"flex:1; background:#1f2937; padding:10px; border-radius:8px; text-align:center;\">\r\n          <b style=\"color:#f1f5f9;\">Input Tokens</b><br>\r\n          <span style=\"color:#60a5fa; font-weight:bold;\">\r\n            {{ (workflow_input[0].token_usage_input_tokens_avg|round(2) if workflow_input|length > 0 else 0) }}\r\n          </span>\r\n        </div>\r\n        <div style=\"flex:1; background:#1f2937; padding:10px; border-radius:8px; text-align:center;\">\r\n          <b style=\"color:#f1f5f9;\">Output Tokens</b><br>\r\n          <span style=\"color:#34d399; font-weight:bold;\">\r\n            {{ (workflow_output[0].token_usage_output_tokens_avg|round(2) if workflow_output|length > 0 else 0) }}\r\n          </span>\r\n        </div>\r\n        <div style=\"flex:1; background:#1f2937; padding:10px; border-radius:8px; text-align:center;\">\r\n          <b style=\"color:#f1f5f9;\">Cache Tokens</b><br>\r\n          <span style=\"color:#facc15; font-weight:bold;\">\r\n            {{ (workflow_cache[0].token_usage_cache_tokens_avg|round(2) if workflow_cache|length > 0 else 0) }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Copilot Card -->\r\n    <div style=\"flex:1; background:#111827; padding:14px; border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,0.5);\">\r\n      <h3 style=\"margin-top:0; color:#f8fafc; font-size:16px; text-align:center;\">Average Tokens for Fabaio</h3>\r\n      <div style=\"display: flex; gap: 10px;\">\r\n        <div style=\"flex:1; background:#1f2937; padding:10px; border-radius:8px; text-align:center;\">\r\n          <b style=\"color:#f1f5f9;\">Input Tokens</b><br>\r\n          <span style=\"color:#60a5fa; font-weight:bold;\">\r\n            {{ (copilot_input[0].token_usage_input_tokens_avg|round(2) if copilot_input|length > 0 else 0) }}\r\n          </span>\r\n        </div>\r\n        <div style=\"flex:1; background:#1f2937; padding:10px; border-radius:8px; text-align:center;\">\r\n          <b style=\"color:#f1f5f9;\">Output Tokens</b><br>\r\n          <span style=\"color:#34d399; font-weight:bold;\">\r\n            {{ (copilot_output[0].token_usage_output_tokens_avg|round(2) if copilot_output|length > 0 else 0) }}\r\n          </span>\r\n        </div>\r\n        <div style=\"flex:1; background:#1f2937; padding:10px; border-radius:8px; text-align:center;\">\r\n          <b style=\"color:#f1f5f9;\">Cache Tokens</b><br>\r\n          <span style=\"color:#facc15; font-weight:bold;\">\r\n            {{ (copilot_cache[0].token_usage_cache_tokens_avg|round(2) if copilot_cache|length > 0 else 0) }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n{% endraw %}\r\n"
        },
        {
            "name": "token_count",
            "value": "{% raw %}\r\n{# ---- Query Data ---- #}\r\n{% set token_data = engine.query_stream_aggs(\r\n    stream=\"rda_chat_sessions\",\r\n    cfxql_query=\"*\",\r\n    aggs=[\r\n        {\"field\": \"token_usage_input_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_output_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_cache_tokens\", \"func\": \"avg\"}\r\n    ],\r\n    groupby=[\"request_type\", \"persona\", \"llm\",\"USER_ID\"]\r\n) %}\r\n\r\n{# ---- Split into Copilot and Agent ---- #}\r\n{% set copilot_data = [] %}\r\n{% set agent_data = [] %}\r\n\r\n{% for row in token_data %}\r\n    {% if row.request_type == \"Copilot\" %}\r\n        {% set _ = copilot_data.append(row) %}\r\n    {% elif row.request_type == \"Agent\" %}\r\n        {% set _ = agent_data.append(row) %}\r\n    {% endif %}\r\n{% endfor %}\r\n\r\n{# ---- Render Tables Side by Side ---- #}\r\n<div style=\"display:flex; gap:20px; margin-top:20px; flex-wrap:wrap;\">\r\n\r\n  {# Copilot Table #}\r\n  <div style=\"flex:1; min-width:450px; background:#111827; padding:16px; border-radius:10px; box-shadow:0 1px 6px rgba(0,0,0,0.4); max-height:700px; overflow-y:auto;\">\r\n    <h3 style=\"color:#f8fafc; text-align:center; margin-bottom:12px;\">Fabaio</h3>\r\n    <table style=\"width:100%; border-collapse:collapse; font-size:13px;\">\r\n      <thead>\r\n        <tr style=\"background:#1f2937; color:#f8fafc;\">\r\n          <th style=\"padding:8px;\">User ID</th>\r\n          <th style=\"padding:8px;\">Persona</th>\r\n          <th style=\"padding:8px;\">LLM</th>\r\n          <th style=\"padding:8px;\">Input</th>\r\n          <th style=\"padding:8px;\">Output</th>\r\n          <th style=\"padding:8px;\">Cache</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {% if copilot_data %}\r\n          {% for row in copilot_data %}\r\n            <tr style=\"background: {{ '#1e293b' if loop.index is even else '#0f172a' }}; color:#f1f5f9;\">\r\n              <td style=\"padding:6px;\">{{ row.USER_ID | default('N/A') }}</td>\r\n              <td style=\"padding:6px;\">{{ row.persona | default('N/A') }}</td>\r\n              <td style=\"padding:6px;\">{{ row.llm | default('N/A') }}</td>\r\n              <td style=\"padding:6px; color:#60a5fa; font-weight:bold;\">{{ row.token_usage_input_tokens_avg | default(0) | round(2) }}</td>\r\n              <td style=\"padding:6px; color:#34d399; font-weight:bold;\">{{ row.token_usage_output_tokens_avg | default(0) | round(2) }}</td>\r\n              <td style=\"padding:6px; color:#facc15; font-weight:bold;\">{{ row.token_usage_cache_tokens_avg | default(0) | round(2) }}</td>\r\n            </tr>\r\n          {% endfor %}\r\n        {% else %}\r\n          <tr><td colspan=\"6\" style=\"text-align:center; color:#f87171;\">No Copilot data found</td></tr>\r\n        {% endif %}\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n\r\n  {# Agent Table #}\r\n  <div style=\"flex:1; min-width:450px; background:#111827; padding:16px; border-radius:10px; box-shadow:0 1px 6px rgba(0,0,0,0.4); max-height:700px; overflow-y:auto;\">\r\n    <h3 style=\"color:#f8fafc; text-align:center; margin-bottom:12px;\">Agent</h3>\r\n    <table style=\"width:100%; border-collapse:collapse; font-size:13px;\">\r\n      <thead>\r\n        <tr style=\"background:#1f2937; color:#f8fafc;\">\r\n          <th style=\"padding:8px;\">Agent</th>\r\n          <th style=\"padding:8px;\">Persona</th>\r\n          <th style=\"padding:8px;\">LLM</th>\r\n          <th style=\"padding:8px;\">Input</th>\r\n          <th style=\"padding:8px;\">Output</th>\r\n          <th style=\"padding:8px;\">Cache</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {% if agent_data %}\r\n          {% for row in agent_data %}\r\n            <tr style=\"background: {{ '#1e293b' if loop.index is even else '#0f172a' }}; color:#f1f5f9;\">\r\n              <td style=\"padding:6px;\">{{ row.USER_ID | default('N/A') }}</td>\r\n              <td style=\"padding:6px;\">{{ row.persona | default('N/A') }}</td>\r\n              <td style=\"padding:6px;\">{{ row.llm | default('N/A') }}</td>\r\n              <td style=\"padding:6px; color:#60a5fa; font-weight:bold;\">{{ row.token_usage_input_tokens_avg | default(0) | round(2) }}</td>\r\n              <td style=\"padding:6px; color:#34d399; font-weight:bold;\">{{ row.token_usage_output_tokens_avg | default(0) | round(2) }}</td>\r\n              <td style=\"padding:6px; color:#facc15; font-weight:bold;\">{{ row.token_usage_cache_tokens_avg | default(0) | round(2) }}</td>\r\n            </tr>\r\n          {% endfor %}\r\n        {% else %}\r\n          <tr><td colspan=\"6\" style=\"text-align:center; color:#f87171;\">No Agent data found</td></tr>\r\n        {% endif %}\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n\r\n</div>\r\n{% endraw %}\r\n"
        },
        {
            "name": "token_count_old",
            "value": "{% raw %}\r\n{# ---- Query Data ---- #}\r\n{% set token_data = engine.query_stream_aggs(\r\n    stream=\"rda_chat_sessions\",\r\n    cfxql_query=\"*\",\r\n    aggs=[\r\n        {\"field\": \"token_usage_input_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_output_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_cache_tokens\", \"func\": \"avg\"}\r\n    ],\r\n    groupby=[\"request_type\",\"USER_ID\"]\r\n) %}\r\n\r\n{% set llm_token_data = engine.query_stream_aggs(\r\n    stream=\"rda_chat_sessions\",\r\n    cfxql_query=\"*\",\r\n    aggs=[\r\n        {\"field\": \"token_usage_input_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_output_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_cache_tokens\", \"func\": \"avg\"}\r\n    ],\r\n    groupby=[\"llm\"]\r\n) %}\r\n\r\n{% set persona_token_data = engine.query_stream_aggs(\r\n    stream=\"rda_chat_sessions\",\r\n    cfxql_query=\"*\",\r\n    aggs=[\r\n        {\"field\": \"token_usage_input_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_output_tokens\", \"func\": \"avg\"},\r\n        {\"field\": \"token_usage_cache_tokens\", \"func\": \"avg\"}\r\n    ],\r\n    groupby=[\"persona\"]\r\n) %}\r\n\r\n{# ---- Split into Copilot and Agent ---- #}\r\n{% set copilot_data = [] %}\r\n{% set agent_data = [] %}\r\n\r\n{% for row in token_data %}\r\n    {% if row.request_type == \"Copilot\" %}\r\n        {% set _ = copilot_data.append(row) %}\r\n    {% elif row.request_type == \"Agent\" %}\r\n        {% set _ = agent_data.append(row) %}\r\n    {% endif %}\r\n{% endfor %}\r\n\r\n{# ---- Render Horizontal Scrollable Cards ---- #}\r\n<div style=\"\r\n    width: 100%;\r\n    height: 100vh;            /* full viewport height */\r\n    overflow-y: auto;         /* vertical scrolling */\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 20px;\r\n    padding: 10px;\r\n    box-sizing: border-box;\r\n\">\r\n\r\n    {# ---- Copilot Section ---- #}\r\n    <div>\r\n        <h3 style=\"color: #ffa500; margin-bottom: 10px;\">Copilot Usage</h3>\r\n        <div style=\"\r\n            width: 100%;\r\n            display: flex;\r\n            gap: 10px;\r\n            align-items: flex-start;\r\n            overflow-x: auto;   /* horizontal scroll for cards */\r\n            padding-bottom: 10px;\r\n            background: rgba(255,165,0,0.05);\r\n            border-radius: 10px;\r\n            scroll-behavior: smooth;\r\n        \">\r\n            {% for row in copilot_data %}\r\n                <div style=\"\r\n                    width: 220px;\r\n                    height: 180px;\r\n                    padding: 16px;\r\n                    background: rgba(255,255,255,0.05);\r\n                    border-radius: 10px;\r\n                    text-align: center;\r\n                    color: #fff;\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    justify-content: center;\r\n                    gap: 6px;\r\n                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);\r\n                    flex-shrink: 0;\r\n                \">\r\n                    <p style=\"font-size: 16px; font-weight: bold; color: #ffa500; margin: 0;\">{{ row.USER_ID }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Input: {{ row.token_usage_input_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Output: {{ row.token_usage_output_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Cache: {{ row.token_usage_cache_tokens_avg | default(0) | round(2) }}</p>\r\n                </div>\r\n            {% endfor %}\r\n        </div>\r\n    </div>\r\n\r\n    {# ---- Agent Section ---- #}\r\n    <div>\r\n        <h3 style=\"color: #00ffff; margin-bottom: 10px;\">Agent Usage</h3>\r\n        <div style=\"\r\n            width: 100%;\r\n            display: flex;\r\n            gap: 10px;\r\n            align-items: flex-start;\r\n            overflow-x: auto;\r\n            padding-bottom: 10px;\r\n            background: rgba(0,255,255,0.05);\r\n            border-radius: 10px;\r\n            scroll-behavior: smooth;\r\n        \">\r\n            {% for row in agent_data %}\r\n                <div style=\"\r\n                    width: 220px;\r\n                    height: 180px;\r\n                    padding: 16px;\r\n                    background: rgba(255,255,255,0.05);\r\n                    border-radius: 10px;\r\n                    text-align: center;\r\n                    color: #fff;\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    justify-content: center;\r\n                    gap: 6px;\r\n                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);\r\n                    flex-shrink: 0;\r\n                \">\r\n                    <p style=\"font-size: 16px; font-weight: bold; color: #00ffff; margin: 0;\">{{ row.USER_ID }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Input: {{ row.token_usage_input_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Output: {{ row.token_usage_output_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Cache: {{ row.token_usage_cache_tokens_avg | default(0) | round(2) }}</p>\r\n                </div>\r\n            {% endfor %}\r\n        </div>\r\n    </div>\r\n\r\n    {# ---- LLM Section ---- #}\r\n    <div>\r\n        <h3 style=\"color: #ff69b4; margin-bottom: 10px;\">LLM Usage</h3>\r\n        <div style=\"\r\n            width: 100%;\r\n            display: flex;\r\n            gap: 10px;\r\n            align-items: flex-start;\r\n            overflow-x: auto;\r\n            padding-bottom: 10px;\r\n            background: rgba(255,105,180,0.05);\r\n            border-radius: 10px;\r\n            scroll-behavior: smooth;\r\n        \">\r\n            {% for row in llm_token_data %}\r\n                <div style=\"\r\n                    width: 220px;\r\n                    height: 180px;\r\n                    padding: 16px;\r\n                    background: rgba(255,255,255,0.05);\r\n                    border-radius: 10px;\r\n                    text-align: center;\r\n                    color: #fff;\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    justify-content: center;\r\n                    gap: 6px;\r\n                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);\r\n                    flex-shrink: 0;\r\n                \">\r\n                    <p style=\"font-size: 16px; font-weight: bold; color: #ff69b4; margin: 0;\">{{ row.llm }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Input: {{ row.token_usage_input_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Output: {{ row.token_usage_output_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Cache: {{ row.token_usage_cache_tokens_avg | default(0) | round(2) }}</p>\r\n                </div>\r\n            {% endfor %}\r\n        </div>\r\n    </div>\r\n\r\n    {# ---- Persona Section ---- #}\r\n    <div>\r\n        <h3 style=\"color: #7fff00; margin-bottom: 10px;\">Persona Usage</h3>\r\n        <div style=\"\r\n            width: 100%;\r\n            display: flex;\r\n            gap: 10px;\r\n            align-items: flex-start;\r\n            overflow-x: auto;\r\n            padding-bottom: 10px;\r\n            background: rgba(127,255,0,0.05);\r\n            border-radius: 10px;\r\n            scroll-behavior: smooth;\r\n        \">\r\n            {% for row in persona_token_data %}\r\n                <div style=\"\r\n                    width: 220px;\r\n                    height: 180px;\r\n                    padding: 16px;\r\n                    background: rgba(255,255,255,0.05);\r\n                    border-radius: 10px;\r\n                    text-align: center;\r\n                    color: #fff;\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    justify-content: center;\r\n                    gap: 6px;\r\n                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);\r\n                    flex-shrink: 0;\r\n                \">\r\n                    <p style=\"font-size: 16px; font-weight: bold; color: #7fff00; margin: 0;\">{{ row.persona }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Input: {{ row.token_usage_input_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Output: {{ row.token_usage_output_tokens_avg | default(0) | round(2) }}</p>\r\n                    <p style=\"font-size: 12px; color: #00ffcc; margin: 0;\">Cache: {{ row.token_usage_cache_tokens_avg | default(0) | round(2) }}</p>\r\n                </div>\r\n            {% endfor %}\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n\r\n{% endraw %}\r\n"
        }
    ]
}