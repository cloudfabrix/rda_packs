{
  "folder": "Default",
  "name": "egydaegsu",
  "description": "test pipeline",
  "usecase": "",
  "category": "",
  "version": "2025_07_24_1",
  "sources": {
    "rn": {
      "name": "rn",
      "type": "rn"
    }
  },
  "data": {
    "name": "egydaegsu",
    "sequence": [
      {
        "tag": "@dm:query-persistent-stream-from-bookmark",
        "query": "name=\"rda_chat_sessions\" and bookmark=\"rda_chat_session\" and query = \" * GET request_type,request_subtype,USER_ID,context_USER_GROUP_NAME,persona,persona_name,llm,token_usage_input_tokens,tool_domain,tool_name,tool_status,token_usage_output_tokens,count_,request_status,provider,_RDA_Id\"",
        "stream": false,
        "limit": 0
      },
      {
        "tag": "*dm:safe-filter",
        "query": "type is not 'client'"
      },
      {
        "tag": "@dm:skip-pipeline-if-shape",
        "query": "row_count=0"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "exclude = 'codeBlocks'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'persona_name,persona'"
      },
      {
        "tag": "@dm:eval",
        "query": "persona = 'persona if persona else persona_name'"
      },
      {
        "tag": "@dm:rename-columns",
        "query": "llm_provider = 'provider' and user_id = 'USER_ID' and user_group = 'context_USER_GROUP_NAME' and ai_persona = 'persona' and llm_hosted_by = 'hosted_by'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'user_group,token_usage_input_tokens'"
      },
      {
        "tag": "@dm:eval",
        "query": "user_group=\"'user_group' if user_group else ''\""
      },
      {
        "tag": "@dm:to-type",
        "query": "columns = 'token_usage_input_tokens' and type = 'float'"
      },
      {
        "tag": "@dm:eval",
        "query": "token_usage_input_tokens=\"float(token_usage_input_tokens) if token_usage_input_tokens else 0\""
      },
      {
        "tag": "@dm:save",
        "query": "name = 'rda-chat-session-data1'"
      },
      {
        "tag": "@dm:save",
        "query": "name = 'rda-chat-session-data'"
      },
      {
        "tag": "@c:new-block"
      },
      {
        "tag": "@dm:recall",
        "query": "name = 'rda-chat-session-data1'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'token_usage_input_tokens'"
      },
      {
        "tag": "*dm:filter",
        "query": "token_usage_input_tokens is not None"
      },
      {
        "tag": "@dm:skip-block-if-shape",
        "query": "row_count = 0"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "include = 'request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_input_tokens'"
      },
      {
        "tag": "@dm:groupby",
        "query": "columns = 'request_type,request_subtype,user_id,user_group,ai_persona,llm' and agg = sum"
      },
      {
        "tag": "@dm:save",
        "query": "name=\"rda_chat_session_data\""
      },
      {
        "tag": "@dm:eval",
        "query": "metric_name = \"'token_count'\" and metric_value = 'token_usage_input_tokens' and direction = \"'input'\""
      },
      {
        "tag": "@dm:eval",
        "query": "config_id=\"uuid()\""
      },
      {
        "tag": "@dm:enrich",
        "query": "dict = 'llm_model_costs' and src_key_cols = 'llm' and dict_key_cols = 'llm_name' and enrich_cols = 'input_token_cost_per1M,provider,hosted_by' and how_type='right'"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "exclude=\"llm_name\""
      },
      {
        "tag": "@dm:rename-columns",
        "query": "llm_provider = 'provider' and llm_hosted_by = 'hosted_by' and llm_name= 'llm'"
      },
      {
        "tag": "@dm:to-type",
        "query": "columns='metric_value' and type='float'"
      },
      {
        "tag": "@dm:save",
        "query": "name=\"before-enrich\""
      },
      {
        "tag": "@dm:dropnull",
        "query": "columns=\"llm_name\""
      },
      {
        "tag": "@dm:save",
        "query": "name=\"token_usage_input_tokens\""
      },
      {
        "tag": "@rn:write-stream",
        "query": "name = 'ai_observability'"
      },
      {
        "tag": "@c:new-block"
      },
      {
        "tag": "@dm:recall",
        "query": "name = 'rda-chat-session-data1'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'token_usage_output_tokens'"
      },
      {
        "tag": "*dm:filter",
        "query": "token_usage_output_tokens is not None"
      },
      {
        "tag": "@dm:skip-block-if-shape",
        "query": "row_count = 0"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "include = 'request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_output_tokens'"
      },
      {
        "tag": "@dm:groupby",
        "query": "columns = 'request_type,request_subtype,user_id,user_group,ai_persona,llm' and agg = sum"
      },
      {
        "tag": "@dm:eval",
        "query": "metric_name = \"'token_count'\" and metric_value = 'token_usage_output_tokens' and direction = \"'output'\""
      },
      {
        "tag": "@dm:eval",
        "query": "config_id=\"uuid()\""
      },
      {
        "tag": "@dm:enrich",
        "query": "dict = 'llm_model_costs' and src_key_cols = 'llm' and dict_key_cols = 'llm_name' and enrich_cols = 'input_token_cost_per1M,provider,hosted_by' and how_type='right'"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "exclude=\"llm_name\""
      },
      {
        "tag": "@dm:rename-columns",
        "query": "llm_provider = 'provider' and llm_hosted_by = 'hosted_by' and llm_name= 'llm'"
      },
      {
        "tag": "@dm:to-type",
        "query": "columns='metric_value' and type='float'"
      },
      {
        "tag": "@dm:dropnull",
        "query": "columns=\"llm_name\""
      },
      {
        "tag": "@dm:save",
        "query": "name=\"token_count_output\""
      },
      {
        "tag": "@rn:write-stream",
        "query": "name = 'ai_observability'"
      },
      {
        "tag": "@c:new-block"
      },
      {
        "tag": "@dm:recall",
        "query": "name = 'rda-chat-session-data1'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'token_usage_input_tokens'"
      },
      {
        "tag": "*dm:filter",
        "query": "token_usage_input_tokens is not None"
      },
      {
        "tag": "@dm:skip-block-if-shape",
        "query": "row_count = 0"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "include = 'request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_input_tokens'"
      },
      {
        "tag": "@dm:eval",
        "query": "token_usage_input_tokens = 'float(token_usage_input_tokens) / 1000000.0'"
      },
      {
        "tag": "@dm:enrich",
        "query": "dict = 'llm_model_costs' and src_key_cols = 'llm' and dict_key_cols = 'llm_name' and enrich_cols = 'input_token_cost_per1M,provider,hosted_by' and how_type='right'"
      },
      {
        "tag": "@dm:rename-columns",
        "query": "llm_provider = 'provider' and llm_hosted_by = 'hosted_by' and llm_name= 'llm'"
      },
      {
        "tag": "@dm:fixnull",
        "query": "columns = 'token_usage_input_tokens' and value = '0' and apply_for_empty = 'yes'"
      },
      {
        "tag": "@dm:to-type",
        "query": "columns = 'input_token_cost_per1M,token_usage_input_tokens' and type = 'float'"
      },
      {
        "tag": "@dm:eval",
        "query": "metric_name = \"'token_cost'\" and metric_value = \"input_token_cost_per1M * token_usage_input_tokens\" and direction = \"'input'\" and currency = '\"USD\"'"
      },
      {
        "tag": "@dm:to_type",
        "query": "columns = 'metric_value' &\ntype  = 'float'"
      },
      {
        "tag": "@dm:eval",
        "query": "config_id=\"uuid()\""
      },
      {
        "tag": "@dm:dropnull",
        "query": "columns=\"llm_name\""
      },
      {
        "tag": "@rn:write-stream",
        "query": "name = 'ai_observability'"
      },
      {
        "tag": "@dm:save",
        "query": "name=\"token_cost_input\""
      },
      {
        "tag": "@c:new-block"
      },
      {
        "tag": "@dm:recall",
        "query": "name = 'rda-chat-session-data1'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'token_usage_output_tokens'"
      },
      {
        "tag": "*dm:filter",
        "query": "token_usage_output_tokens is not None"
      },
      {
        "tag": "@dm:skip-block-if-shape",
        "query": "row_count = 0"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "include = 'request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_output_tokens'"
      },
      {
        "tag": "@dm:eval",
        "query": "token_usage_output_tokens = 'float(token_usage_output_tokens) / 1000000.0'"
      },
      {
        "tag": "@dm:enrich",
        "query": "dict = 'llm_model_costs' and src_key_cols = 'llm' and dict_key_cols = 'llm_name' and enrich_cols = 'input_token_cost_per1M,provider,hosted_by' and how_type='right'"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "exclude=\"llm_name\""
      },
      {
        "tag": "@dm:rename-columns",
        "query": "llm_provider = 'provider' and llm_hosted_by = 'hosted_by' and llm_name= 'llm'"
      },
      {
        "tag": "@dm:fixnull",
        "query": "columns = 'token_usage_output_tokens' and value = '0' and apply_for_empty = 'yes'"
      },
      {
        "tag": "@dm:to-type",
        "query": "columns = 'input_token_cost_per1M,token_usage_output_tokens' and type = 'float'"
      },
      {
        "tag": "@dm:eval",
        "query": "metric_name = \"'token_cost'\" and metric_value  = \"input_token_cost_per1M * token_usage_output_tokens\" and direction = \"'output'\" and currency = \"'USD'\""
      },
      {
        "tag": "@dm:to_type",
        "query": "columns = 'metric_value' &\ntype  = 'float'"
      },
      {
        "tag": "@dm:eval",
        "query": "config_id=\"uuid()\""
      },
      {
        "tag": "@dm:dropnull",
        "query": "columns=\"llm_name\""
      },
      {
        "tag": "@rn:write-stream",
        "query": "name = 'ai_observability'"
      },
      {
        "tag": "@dm:save",
        "query": "name=\"token_cost_output\""
      },
      {
        "tag": "@c:new-block"
      },
      {
        "tag": "@dm:recall",
        "query": "name = 'rda-chat-session-data1'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'tool_name'"
      },
      {
        "tag": "*dm:filter",
        "query": "tool_name is not None"
      },
      {
        "tag": "@dm:skip-block-if-shape",
        "query": "row_count = 0"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "include = 'request_type|request_subtype|user_id|user_group|ai_persona|^llm$|count_|tool_domain|tool_name|tool_status'"
      },
      {
        "tag": "@dm:groupby",
        "query": "columns = 'request_type,request_subtype,user_id,user_group,ai_persona,llm,tool_domain,tool_name,tool_status' and agg = sum"
      },
      {
        "tag": "@dm:enrich",
        "query": "dict = 'llm_model_costs' and src_key_cols = 'llm' and dict_key_cols = 'llm_name' and enrich_cols = 'provider,hosted_by' and how_type='right'"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "exclude=\"llm_name\""
      },
      {
        "tag": "@dm:eval",
        "query": "metric_name = \"'tools_called'\" and metric_value = 'count_'"
      },
      {
        "tag": "@dm:rename-columns",
        "query": "llm_provider = 'provider' and llm_hosted_by = 'hosted_by' and llm_name= 'llm'"
      },
      {
        "tag": "@dm:to-type",
        "query": "columns='metric_value' and type='float'"
      },
      {
        "tag": "@dm:eval",
        "query": "config_id=\"uuid()\""
      },
      {
        "tag": "@dm:dropnull",
        "query": "columns=\"llm_name\""
      },
      {
        "tag": "@dm:save",
        "query": "name = 'tools_called_Data'"
      },
      {
        "tag": "@rn:write-stream",
        "query": "name = 'ai_observability'"
      },
      {
        "tag": "@c:new-block"
      },
      {
        "tag": "@dm:recall",
        "query": "name = 'rda-chat-session-data1'"
      },
      {
        "tag": "@dm:add-missing-columns",
        "query": "columns = 'request_status'"
      },
      {
        "tag": "*dm:filter",
        "query": "request_status is not None"
      },
      {
        "tag": "@dm:skip-block-if-shape",
        "query": "row_count = 0"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "include = 'request_type|request_subtype|user_id|user_group|ai_persona|^llm$|count_|request_status'"
      },
      {
        "tag": "@dm:groupby",
        "query": "columns = 'request_type,request_subtype,user_id,user_group,ai_persona,llm,request_status'"
      },
      {
        "tag": "@dm:enrich",
        "query": "dict = 'llm_model_costs' and src_key_cols = 'llm' and dict_key_cols = 'llm_name' and enrich_cols = 'provider,hosted_by' and how_type='right'"
      },
      {
        "tag": "@dm:selectcolumns",
        "query": "exclude=\"llm_name\""
      },
      {
        "tag": "@dm:eval",
        "query": "metric_name = \"'request_count'\" and metric_value = 'count_'"
      },
      {
        "tag": "@dm:to-type",
        "query": "columns='metric_value' and type='float'"
      },
      {
        "tag": "@dm:rename-columns",
        "query": "llm_provider = 'provider' and llm_hosted_by = 'hosted_by' and llm_name= 'llm'"
      },
      {
        "tag": "@dm:eval",
        "query": "config_id=\"uuid()\"",
        "comment": "--> @dm:save name = 'status_count'"
      },
      {
        "tag": "@dm:dropnull",
        "query": "columns=\"llm_name\""
      },
      {
        "tag": "@rn:write-stream",
        "query": "name = 'ai_observability'"
      },
      {
        "tag": "@dm:save",
        "query": "name = 'status_count'"
      }
    ]
  },
  "artifacts": [
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data1",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data1",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda_chat_session_data",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "llm_model_costs",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "before-enrich",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "token_usage_input_tokens",
      "access": "write"
    },
    {
      "artifact_type": "rda-network-stream",
      "artifact_name": "ai_observability",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data1",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "llm_model_costs",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "token_count_output",
      "access": "write"
    },
    {
      "artifact_type": "rda-network-stream",
      "artifact_name": "ai_observability",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data1",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "llm_model_costs",
      "access": "read"
    },
    {
      "artifact_type": "rda-network-stream",
      "artifact_name": "ai_observability",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "token_cost_input",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data1",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "llm_model_costs",
      "access": "read"
    },
    {
      "artifact_type": "rda-network-stream",
      "artifact_name": "ai_observability",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "token_cost_output",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data1",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "llm_model_costs",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "tools_called_Data",
      "access": "write"
    },
    {
      "artifact_type": "rda-network-stream",
      "artifact_name": "ai_observability",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "rda-chat-session-data1",
      "access": "read"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "llm_model_costs",
      "access": "read"
    },
    {
      "artifact_type": "rda-network-stream",
      "artifact_name": "ai_observability",
      "access": "write"
    },
    {
      "artifact_type": "dataset",
      "artifact_name": "status_count",
      "access": "write"
    }
  ],
  "directives": {
    "stream": false,
    "limit": 0
  },
  "html_data": "\n        <style>\n\n        .tooltip {\n            position: relative;\n            display: inline-block;\n            border-bottom: 1px dotted black; /* If you want dots under the hoverable text */\n            }\n\n        /* Tooltip text */\n        .tooltip .tooltiptext {\n            visibility: hidden;\n            width: 120px;\n            background-color: black;\n            color: #fff;\n            text-align: center;\n            padding: 5px 0;\n            border-radius: 6px;\n            \n            /* Position the tooltip text - see examples below! */\n            position: absolute;\n            z-index: 1;\n        }\n\n         /* Show the tooltip text when you mouse over the tooltip container */\n        .tooltip:hover .tooltiptext {\n            visibility: visible;\n            }\n\n        .bot .tooltiptext {\n            visibility: hidden;\n            width: 550px;\n            background-color: black;\n            color: #fff;\n            text-align: center;\n            padding: 5px 0;\n            border-radius: 6px;\n            \n            /* Position the tooltip text - see examples below! */\n            position: absolute;\n            z-index: 1;\n        }\n\n         /* Show the tooltip text when you mouse over the tooltip container */\n        .bot:hover .tooltiptext {\n            visibility: visible;\n        }\n\n        .bot_error .tooltiptext {\n            visibility: hidden;\n            width: 450px;\n            background-color: #800;\n            color: #fff;\n            text-align: center;\n            padding: 5px 0;\n            border-radius: 6px;\n            \n            /* Position the tooltip text - see examples below! */\n            position: absolute;\n            z-index: 1;\n        }\n\n         /* Show the tooltip text when you mouse over the tooltip container */\n        .bot_error:hover .tooltiptext {\n            visibility: visible;\n        }\n\n        .bot_templ .tooltiptext {\n            visibility: hidden;\n            width: 425px;\n            background-color: #777;\n            color: #fff;\n            text-align: center;\n            padding: 5px 0;\n            border-radius: 6px;\n            \n            /* Position the tooltip text - see examples below! */\n            position: absolute;\n            z-index: 1;\n        }\n\n         /* Show the tooltip text when you mouse over the tooltip container */\n        .bot_templ:hover .tooltiptext {\n            visibility: visible;\n        }\n\n        .bot {\n            position: relative;\n            display: inline-block;\n            color: #080;\n            font-weight: bold;\n        }\n\n        .bot_error {\n            position: relative;\n            display: inline-block;\n            color: #800;\n            font-weight: bold;\n        }\n\n        .bot_templ {\n            position: relative;\n            display: inline-block;\n            color: #088;\n            font-weight: bold;\n        }\n        \n        .link {\n            color: #FFA500;\n        }\n    \n        .comment {\n            color: #888;\n        }\n        \n        .directive {\n            color: #08dddd;\n        }\n        \n        .directive_error {\n            color: #888;\n        }\n        \n        code {\n          color: 0033FF;\n          background-color: #fff;\n        }\n\n        .code {\n          color: 0033FF;\n          background-color: #fff;\n        }\n\n        </style>\n        <div class='directive'>%% stream = no and limit = 0\n</div><div style='padding-left: 20px;'><span class='bot'>@dm:query-persistent-stream-from-bookmark<span class='tooltiptext'>This is a streaming bot that reads one or more rows from the last bookmarked record in a persistent stream via CFXQL filter criteria</span></span> &nbsp; <code style='color: #0033FF; background-color: #fff;'> name=&quot;rda_chat_sessions&quot; and bookmark=&quot;rda_chat_session&quot; and query = &quot; * GET request_type,request_subtype,USER_ID,context_USER_GROUP_NAME,persona,persona_name,llm,token_usage_input_tokens,tool_domain,tool_name,tool_status,token_usage_output_tokens,count_,request_status,provider,_RDA_Id&quot; </code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>*dm:safe-filter<span class='tooltiptext'>Apply safe CFXQL filtering on the data</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>type is not &#x27;client&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:skip-pipeline-if-shape<span class='tooltiptext'>Skip rest of the pipeline if input dataframe shape meets criteria expressed using &#x27;row_count&#x27; &amp; &#x27;column_count&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>row_count=0</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>exclude = &#x27;codeBlocks&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;persona_name,persona&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>persona = &#x27;persona if persona else persona_name&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:rename-columns<span class='tooltiptext'>Rename specified column names using new_column_name = &#x27;old_column_name&#x27; format</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>llm_provider = &#x27;provider&#x27; and user_id = &#x27;USER_ID&#x27; and user_group = &#x27;context_USER_GROUP_NAME&#x27; and ai_persona = &#x27;persona&#x27; and llm_hosted_by = &#x27;hosted_by&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;user_group,token_usage_input_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>user_group=&quot;&#x27;user_group&#x27; if user_group else &#x27;&#x27;&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to-type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;token_usage_input_tokens&#x27; and type = &#x27;float&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>token_usage_input_tokens=&quot;float(token_usage_input_tokens) if token_usage_input_tokens else 0&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data1&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data&#x27;</code>\n\n</div><div style='padding: 10px;'></div><div><span class='link'>-->&nbsp; </span><span class='bot'>@c:new-block<span class='tooltiptext'>Start a new block within the pipeline</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'></code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:recall<span class='tooltiptext'>Recall (load) a previously saved dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data1&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;token_usage_input_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>*dm:filter<span class='tooltiptext'>Apply CFXQL filtering on the data</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>token_usage_input_tokens is not None</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:skip-block-if-shape<span class='tooltiptext'>Skip rest of the current block if input dataframe shape meets criteria expressed using &#x27;row_count&#x27; &amp; &#x27;column_count&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>row_count = 0</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>include = &#x27;request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_input_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:groupby<span class='tooltiptext'>Group rows using specified &#x27;columns&#x27; and specified &#x27;agg&#x27; function</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;request_type,request_subtype,user_id,user_group,ai_persona,llm&#x27; and agg = sum</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name=&quot;rda_chat_session_data&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>metric_name = &quot;&#x27;token_count&#x27;&quot; and metric_value = &#x27;token_usage_input_tokens&#x27; and direction = &quot;&#x27;input&#x27;&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>config_id=&quot;uuid()&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:enrich<span class='tooltiptext'>Enrich the input dataframe using a saved dictionary dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>dict = &#x27;llm_model_costs&#x27; and src_key_cols = &#x27;llm&#x27; and dict_key_cols = &#x27;llm_name&#x27; and enrich_cols = &#x27;input_token_cost_per1M,provider,hosted_by&#x27; and how_type=&#x27;right&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>exclude=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:rename-columns<span class='tooltiptext'>Rename specified column names using new_column_name = &#x27;old_column_name&#x27; format</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>llm_provider = &#x27;provider&#x27; and llm_hosted_by = &#x27;hosted_by&#x27; and llm_name= &#x27;llm&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to-type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&#x27;metric_value&#x27; and type=&#x27;float&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name=&quot;before-enrich&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:dropnull<span class='tooltiptext'>Drop rows if specified &#x27;columns&#x27; have null values</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name=&quot;token_usage_input_tokens&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@rn:write-stream<span class='tooltiptext'>Write input dataframe as messages to a specified stream. Each row is encoded as a JSON object. No acknowledgement is expected.</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;ai_observability&#x27;</code>\n\n</div><div style='padding: 10px;'></div><div><span class='link'>-->&nbsp; </span><span class='bot'>@c:new-block<span class='tooltiptext'>Start a new block within the pipeline</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'></code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:recall<span class='tooltiptext'>Recall (load) a previously saved dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data1&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;token_usage_output_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>*dm:filter<span class='tooltiptext'>Apply CFXQL filtering on the data</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>token_usage_output_tokens is not None</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:skip-block-if-shape<span class='tooltiptext'>Skip rest of the current block if input dataframe shape meets criteria expressed using &#x27;row_count&#x27; &amp; &#x27;column_count&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>row_count = 0</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>include = &#x27;request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_output_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:groupby<span class='tooltiptext'>Group rows using specified &#x27;columns&#x27; and specified &#x27;agg&#x27; function</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;request_type,request_subtype,user_id,user_group,ai_persona,llm&#x27; and agg = sum</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>metric_name = &quot;&#x27;token_count&#x27;&quot; and metric_value = &#x27;token_usage_output_tokens&#x27; and direction = &quot;&#x27;output&#x27;&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>config_id=&quot;uuid()&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:enrich<span class='tooltiptext'>Enrich the input dataframe using a saved dictionary dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>dict = &#x27;llm_model_costs&#x27; and src_key_cols = &#x27;llm&#x27; and dict_key_cols = &#x27;llm_name&#x27; and enrich_cols = &#x27;input_token_cost_per1M,provider,hosted_by&#x27; and how_type=&#x27;right&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>exclude=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:rename-columns<span class='tooltiptext'>Rename specified column names using new_column_name = &#x27;old_column_name&#x27; format</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>llm_provider = &#x27;provider&#x27; and llm_hosted_by = &#x27;hosted_by&#x27; and llm_name= &#x27;llm&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to-type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&#x27;metric_value&#x27; and type=&#x27;float&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:dropnull<span class='tooltiptext'>Drop rows if specified &#x27;columns&#x27; have null values</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name=&quot;token_count_output&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@rn:write-stream<span class='tooltiptext'>Write input dataframe as messages to a specified stream. Each row is encoded as a JSON object. No acknowledgement is expected.</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;ai_observability&#x27;</code>\n\n</div><div style='padding: 10px;'></div><div><span class='link'>-->&nbsp; </span><span class='bot'>@c:new-block<span class='tooltiptext'>Start a new block within the pipeline</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'></code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:recall<span class='tooltiptext'>Recall (load) a previously saved dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data1&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;token_usage_input_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>*dm:filter<span class='tooltiptext'>Apply CFXQL filtering on the data</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>token_usage_input_tokens is not None</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:skip-block-if-shape<span class='tooltiptext'>Skip rest of the current block if input dataframe shape meets criteria expressed using &#x27;row_count&#x27; &amp; &#x27;column_count&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>row_count = 0</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>include = &#x27;request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_input_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>token_usage_input_tokens = &#x27;float(token_usage_input_tokens) / 1000000.0&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:enrich<span class='tooltiptext'>Enrich the input dataframe using a saved dictionary dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>dict = &#x27;llm_model_costs&#x27; and src_key_cols = &#x27;llm&#x27; and dict_key_cols = &#x27;llm_name&#x27; and enrich_cols = &#x27;input_token_cost_per1M,provider,hosted_by&#x27; and how_type=&#x27;right&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:rename-columns<span class='tooltiptext'>Rename specified column names using new_column_name = &#x27;old_column_name&#x27; format</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>llm_provider = &#x27;provider&#x27; and llm_hosted_by = &#x27;hosted_by&#x27; and llm_name= &#x27;llm&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:fixnull<span class='tooltiptext'>Replace null values in a comma seperatedd column list</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;token_usage_input_tokens&#x27; and value = &#x27;0&#x27; and apply_for_empty = &#x27;yes&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to-type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;input_token_cost_per1M,token_usage_input_tokens&#x27; and type = &#x27;float&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>metric_name = &quot;&#x27;token_cost&#x27;&quot; and metric_value = &quot;input_token_cost_per1M * token_usage_input_tokens&quot; and direction = &quot;&#x27;input&#x27;&quot; and currency = &#x27;&quot;USD&quot;&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to_type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;metric_value&#x27; &amp;</code>\n<br/>    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code style='color: #0033FF; background-color: #fff;'>type  = &#x27;float&#x27;</code>\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>config_id=&quot;uuid()&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:dropnull<span class='tooltiptext'>Drop rows if specified &#x27;columns&#x27; have null values</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@rn:write-stream<span class='tooltiptext'>Write input dataframe as messages to a specified stream. Each row is encoded as a JSON object. No acknowledgement is expected.</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;ai_observability&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name=&quot;token_cost_input&quot;</code>\n\n</div><div style='padding: 10px;'></div><div><span class='link'>-->&nbsp; </span><span class='bot'>@c:new-block<span class='tooltiptext'>Start a new block within the pipeline</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'></code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:recall<span class='tooltiptext'>Recall (load) a previously saved dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data1&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;token_usage_output_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>*dm:filter<span class='tooltiptext'>Apply CFXQL filtering on the data</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>token_usage_output_tokens is not None</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:skip-block-if-shape<span class='tooltiptext'>Skip rest of the current block if input dataframe shape meets criteria expressed using &#x27;row_count&#x27; &amp; &#x27;column_count&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>row_count = 0</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>include = &#x27;request_type|request_subtype|user_id|user_group|ai_persona|^llm$|token_usage_output_tokens&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>token_usage_output_tokens = &#x27;float(token_usage_output_tokens) / 1000000.0&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:enrich<span class='tooltiptext'>Enrich the input dataframe using a saved dictionary dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>dict = &#x27;llm_model_costs&#x27; and src_key_cols = &#x27;llm&#x27; and dict_key_cols = &#x27;llm_name&#x27; and enrich_cols = &#x27;input_token_cost_per1M,provider,hosted_by&#x27; and how_type=&#x27;right&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>exclude=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:rename-columns<span class='tooltiptext'>Rename specified column names using new_column_name = &#x27;old_column_name&#x27; format</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>llm_provider = &#x27;provider&#x27; and llm_hosted_by = &#x27;hosted_by&#x27; and llm_name= &#x27;llm&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:fixnull<span class='tooltiptext'>Replace null values in a comma seperatedd column list</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;token_usage_output_tokens&#x27; and value = &#x27;0&#x27; and apply_for_empty = &#x27;yes&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to-type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;input_token_cost_per1M,token_usage_output_tokens&#x27; and type = &#x27;float&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>metric_name = &quot;&#x27;token_cost&#x27;&quot; and metric_value  = &quot;input_token_cost_per1M * token_usage_output_tokens&quot; and direction = &quot;&#x27;output&#x27;&quot; and currency = &quot;&#x27;USD&#x27;&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to_type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;metric_value&#x27; &amp;</code>\n<br/>    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code style='color: #0033FF; background-color: #fff;'>type  = &#x27;float&#x27;</code>\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>config_id=&quot;uuid()&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:dropnull<span class='tooltiptext'>Drop rows if specified &#x27;columns&#x27; have null values</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@rn:write-stream<span class='tooltiptext'>Write input dataframe as messages to a specified stream. Each row is encoded as a JSON object. No acknowledgement is expected.</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;ai_observability&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name=&quot;token_cost_output&quot;</code>\n\n</div><div style='padding: 10px;'></div><div><span class='link'>-->&nbsp; </span><span class='bot'>@c:new-block<span class='tooltiptext'>Start a new block within the pipeline</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'></code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:recall<span class='tooltiptext'>Recall (load) a previously saved dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data1&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;tool_name&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>*dm:filter<span class='tooltiptext'>Apply CFXQL filtering on the data</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>tool_name is not None</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:skip-block-if-shape<span class='tooltiptext'>Skip rest of the current block if input dataframe shape meets criteria expressed using &#x27;row_count&#x27; &amp; &#x27;column_count&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>row_count = 0</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>include = &#x27;request_type|request_subtype|user_id|user_group|ai_persona|^llm$|count_|tool_domain|tool_name|tool_status&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:groupby<span class='tooltiptext'>Group rows using specified &#x27;columns&#x27; and specified &#x27;agg&#x27; function</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;request_type,request_subtype,user_id,user_group,ai_persona,llm,tool_domain,tool_name,tool_status&#x27; and agg = sum</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:enrich<span class='tooltiptext'>Enrich the input dataframe using a saved dictionary dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>dict = &#x27;llm_model_costs&#x27; and src_key_cols = &#x27;llm&#x27; and dict_key_cols = &#x27;llm_name&#x27; and enrich_cols = &#x27;provider,hosted_by&#x27; and how_type=&#x27;right&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>exclude=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>metric_name = &quot;&#x27;tools_called&#x27;&quot; and metric_value = &#x27;count_&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:rename-columns<span class='tooltiptext'>Rename specified column names using new_column_name = &#x27;old_column_name&#x27; format</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>llm_provider = &#x27;provider&#x27; and llm_hosted_by = &#x27;hosted_by&#x27; and llm_name= &#x27;llm&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to-type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&#x27;metric_value&#x27; and type=&#x27;float&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>config_id=&quot;uuid()&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:dropnull<span class='tooltiptext'>Drop rows if specified &#x27;columns&#x27; have null values</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;tools_called_Data&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@rn:write-stream<span class='tooltiptext'>Write input dataframe as messages to a specified stream. Each row is encoded as a JSON object. No acknowledgement is expected.</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;ai_observability&#x27;</code>\n\n</div><div style='padding: 10px;'></div><div><span class='link'>-->&nbsp; </span><span class='bot'>@c:new-block<span class='tooltiptext'>Start a new block within the pipeline</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'></code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:recall<span class='tooltiptext'>Recall (load) a previously saved dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;rda-chat-session-data1&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:add-missing-columns<span class='tooltiptext'>Add columns if not found in the input</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;request_status&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>*dm:filter<span class='tooltiptext'>Apply CFXQL filtering on the data</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>request_status is not None</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:skip-block-if-shape<span class='tooltiptext'>Skip rest of the current block if input dataframe shape meets criteria expressed using &#x27;row_count&#x27; &amp; &#x27;column_count&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>row_count = 0</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>include = &#x27;request_type|request_subtype|user_id|user_group|ai_persona|^llm$|count_|request_status&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:groupby<span class='tooltiptext'>Group rows using specified &#x27;columns&#x27; and specified &#x27;agg&#x27; function</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns = &#x27;request_type,request_subtype,user_id,user_group,ai_persona,llm,request_status&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:enrich<span class='tooltiptext'>Enrich the input dataframe using a saved dictionary dataset</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>dict = &#x27;llm_model_costs&#x27; and src_key_cols = &#x27;llm&#x27; and dict_key_cols = &#x27;llm_name&#x27; and enrich_cols = &#x27;provider,hosted_by&#x27; and how_type=&#x27;right&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:selectcolumns<span class='tooltiptext'>Select columns using &#x27;include&#x27; regex and/or &#x27;exclude&#x27; regex</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>exclude=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>metric_name = &quot;&#x27;request_count&#x27;&quot; and metric_value = &#x27;count_&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:to-type<span class='tooltiptext'>Change data type to str or int or float for specified columns</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&#x27;metric_value&#x27; and type=&#x27;float&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:rename-columns<span class='tooltiptext'>Rename specified column names using new_column_name = &#x27;old_column_name&#x27; format</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>llm_provider = &#x27;provider&#x27; and llm_hosted_by = &#x27;hosted_by&#x27; and llm_name= &#x27;llm&#x27;</code>\n\n</div><div style='padding-left: 20px;'><div class='comment'>&nbsp;&nbsp;&nbsp;&nbsp;## --> @dm:save name = 'status_count'</div>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:eval<span class='tooltiptext'>Map values using evaluate function. Speciy one of more column = &#x27;expression&#x27; pairs</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>config_id=&quot;uuid()&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:dropnull<span class='tooltiptext'>Drop rows if specified &#x27;columns&#x27; have null values</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>columns=&quot;llm_name&quot;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@rn:write-stream<span class='tooltiptext'>Write input dataframe as messages to a specified stream. Each row is encoded as a JSON object. No acknowledgement is expected.</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;ai_observability&#x27;</code>\n\n</div><div style='padding-left: 20px;'>    <span class='link'>-->&nbsp; </span><span class='bot'>@dm:save<span class='tooltiptext'>Save the dataset with &#x27;name&#x27;</span></span> &nbsp;</span> &nbsp; <code style='color: #0033FF; background-color: #fff;'>name = &#x27;status_count&#x27;</code>\n\n</div>\n",
  "template_type": null
}