enabled: true
domain: ai_observability
description: Agentic AI Observability related tools. Typically contains tools related to query ai_observability and rda_chat_sessions stream.
tools:
- name: get_ai_observability_meta_data
  type: streamMetadata
  stream: ai_observability
  save_to_cache: auto
  description: >-
    Retrieves the complete schema of AI observability fields available in the system. Always call this tool first when asked about observability data to get the relevant fields to query.

- name: get_observability_data
  type: streamQuery
  stream: ai_observability
  description: Get AI observability data, keep the limit as 0 always
  save_to_cache: false
  data_format: csv
  response_prefix: Here are AI observability data in CSV format
  no_data_message: No data found for the specified parameters
  result_columns:
    ai_persona: AI Persona
    config_id: Config ID
    llm_hosted_by: LLM Hosted By
    llm_name: LLM Name
    llm_provider: LLM Provider
    metric_name: Metric Name
    metric_value: Metric Value
    request_status: Request Status
    request_subtype: Request Subtype
    request_type: Request Type
    user_group: User Group
    user_id: User ID
    timestamp: Timestamp
  parameters:
  - name: user_id
    description: User ID of the user (e.g 'sanika', 'Faizan', 'Ravi', 'raju.datla@cloudfabrix.com', 'Anomaly Detector Agent')
    operator: "="
    queryMapping: user_id contains '{{user_id}}'
  - name: limit
    description: Number of records to fetch, keep it as 0 always
    required: true
    default: 0
    use_in_cfxql: false
  - name: from_time
    description: From time (ISO format '2024-01-01T00:00:00Z')
    required: false
    queryMapping: timestamp is after '{{from_time}}'
  - name: to_time
    description: To time (ISO format '2024-12-31T23:59:59Z')
    required: false
    queryMapping: timestamp is before '{{to_time}}'
  - name: ai_persona
    description: AI persona filter (e.g., 'Lab Admin', 'Assistant')
    operator: "="
    queryMapping: ai_persona = '{{ai_persona}}'
  - name: request_type
    description: Type of request (e.g., 'Copilot', 'Chat', 'Query')
    operator: "="
    queryMapping: request_type = '{{request_type}}'
  - name: request_status
    description: Status of the request (e.g., 'success', 'error', 'pending')
    operator: "="
    queryMapping: request_status = '{{request_status}}'
  - name: llm_provider
    description: LLM provider (e.g., 'Anthropic', 'OpenAI', 'Google')
    operator: "="
    queryMapping: llm_provider = '{{llm_provider}}'
  - name: llm_name
    description: Specific LLM model name (e.g., 'claude-sonnet-4', 'gpt-4', 'gemini-pro')
    operator: "="
    queryMapping: llm_name = '{{llm_name}}'
  - name: metric_name
    description: Metric name to filter (e.g., 'request_count', 'token_count', 'token_cost')
    operator: "="
    queryMapping: metric_name = '{{metric_name}}'
  - name: user_group
    description: User group filter
    operator: "="
    queryMapping: user_group = '{{user_group}}'


- name: get_observability_token_cost_count
  type: streamQueryAggs
  stream: ai_observability
  description: Get aggregated AI observability data with grouping and aggregation
  save_to_cache: auto
  data_format: csv
  aggs:
    template_type: jinja
    template: |
      [
        {"func": "sum", "field": "metric_value", "label": "total_token_cost"}
      ]
  extra_filter: metric_name = 'token_cost'
  parameters:
  - name: groupby
    description: Fields to group by (comma-separated). Common fields user_id, ai_persona, request_type, llm_provider, metric_name
    use_in_cfxql: false
    required: true
  - name: user_id
    description: User ID to filter data (e.g 'Atharva', 'Anomaly Detector Agent')
    operator: "="
    queryMapping: user_id contains '{{user_id}}'
  - name: from_time
    description: Start time for data filtering
    required: false
    queryMapping: timestamp is after '{{from_time}}'
  - name: to_time
    description: End time for data filtering
    required: false
    queryMapping: timestamp is before '{{to_time}}'
  - name: ai_persona
    description: AI persona filter
    operator: "="
    queryMapping: ai_persona = '{{ai_persona}}'
  - name: request_type
    description: Request type filter
    operator: "="
    queryMapping: request_type = '{{request_type}}'

- name: get_observability_token_count
  type: streamQueryAggs
  stream: ai_observability
  description: Get total token count aggregated by user. Automatically filters for token_count metric_name and sums metric_value.
  save_to_cache: auto
  data_format: csv
  aggs:
    template_type: jinja
    template: |
      [
        {"func": "sum", "field": "metric_value", "label": "total_token_count"}
      ]
  extra_filter: metric_name = 'token_count'
  parameters:
  - name: groupby
    description: Fields to group by (comma-separated). Default user_id
    use_in_cfxql: false
    default: user_id
  - name: direction
    description: direction whether the tone used is input or output
    operator: "="
    required: false
    queryMapping: direction contains '{{direction}}'
  - name: user_id
    description: Specific user ID to filter (optional) (e.g 'Nitin' , 'Root Cause Analysis Agent')
    operator: "="
    queryMapping: user_id contains '{{user_id}}'
  - name: from_time
    description: Start time for data filtering
    required: false
    queryMapping: timestamp is after '{{from_time}}'
  - name: to_time
    description: End time for data filtering
    required: false
    queryMapping: timestamp is before '{{to_time}}'
  - name: ai_persona
    description: AI persona filter
    operator: "="
    queryMapping: ai_persona = '{{ai_persona}}'
  - name: llm_provider
    description: LLM provider filter
    operator: "="
    queryMapping: llm_provider = '{{llm_provider}}'

- name: get_observability_tools_called_count
  type: streamQueryAggs
  stream: ai_observability
  description: Get aggregated tools called count
  save_to_cache: auto
  data_format: csv
  aggs:
    template_type: jinja
    template: |
      [
        {"func": "sum", "field": "metric_value", "label": "total_tools_called"}
      ]
  extra_filter: metric_name = 'tools_called'
  parameters:
  - name: groupby
    description: Fields to group by (comma-separated). Common fields user_id, ai_persona, request_type, llm_provider, metric_name
    use_in_cfxql: false
    required: true
  - name: user_id
    description: User ID to filter data (e.g 'Rached' , 'Lab Admin Agent')
    operator: "="
    queryMapping: user_id contains '{{user_id}}'
  - name: from_time
    description: Start time for data filtering
    required: false
    queryMapping: timestamp is after '{{from_time}}'
  - name: to_time
    description: End time for data filtering
    required: false
    queryMapping: timestamp is before '{{to_time}}'
  - name: ai_persona
    description: AI persona filter
    operator: "="
    queryMapping: ai_persona = '{{ai_persona}}'
  - name: request_type
    description: Request type filter
    operator: "="
    queryMapping: request_type = '{{request_type}}'
  - name: llm_provider
    description: LLM provider filter
    operator: "="
    queryMapping: llm_provider = '{{llm_provider}}'
 


