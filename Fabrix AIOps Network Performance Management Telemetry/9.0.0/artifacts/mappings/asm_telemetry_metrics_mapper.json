{
    "description": "asm_telemetry_metric",
    "sourcename": "asm_telemetry",
    "targetname": "OIA Alert",
    "sourceendpointtype": "webhook-basic",
    "sourcecategory": "alerts",
    "sourcetypeid": "OIA Alert",
    "targetendpointtype": "kafka-notification",
    "targetcategory": "alerts",
    "targettypeid": "OIA Alert",
    "sourcebundle": "default",
    "targetbundle": "default",
    "sourcemapper": "default.mapper-default-events-inbound-json",
    "sourceartifact": "events-inbound-default.json",
    "targetmapper": null,
    "sourcepipeline": "default.pipeline-inbound",
    "targetpipeline": null,
    "enabled": "Yes",
    "filters": null,
    "enrichment": null,
    "scriptinput": "{\r\n    \"alert_type\": \"metric\",\r\n    \"alert_name\": \"cpu-metric-alert-test\",\r\n    \"state\": \"OPEN\",\r\n    \"md5\": \"2eff8009547539ce9f6c8f2ce611c8da\",\r\n    \"open_timestamp\": \"2025-08-19T05:44:51.512663\",\r\n    \"last_open_notification_timestamp\": \"2025-08-19T05:44:51.512663\",\r\n    \"data\": {\r\n        \"i_agent_host\": \"10.95.158.1\",\r\n        \"name\": \"cpu\",\r\n        \"m_cpu_usage_avg\": 67.14285714285714\r\n    },\r\n    \"threshold\": \"62\",\r\n    \"attributes\": {\r\n        \"severity\": \"CRITICAL\",\r\n        \"metric_name\": \"m_cpu_usage\",\r\n        \"metric_value_field\": \"m_cpu_usage_avg\"\r\n    }\r\n}",
    "mappingtype": "json",
    "mappingscript": "{\n  \"conditions\": [\n    \"alert_type == 'metric'\"\n  ],\n  \"mappings\": [\n{\n      \"to\": \"sourceSystemType\",\n      \"func\": {\n        \"evaluate\":{\n            \"expr\":\"'ASM'\"\n        }\n      }\n},\n\n    {\n      \"from\": \"data\",\n      \"to\": \"assetIpAddress\",\n      \"func\": {\n        \"valueRef\": {\n          \"path\": \"i_agent_host\"\n        }\n      }\n    },\n    {\n      \"from\": \"data\",\n      \"to\": \"name\",\n      \"func\": {\n        \"valueRef\": {\n          \"path\": \"name\"\n        }\n      }\n    },\n    \n{\n        \"to\": \"metric_name\",\n        \"func\": {\n            \"evaluate\": {\n                \"expr\": \"attributes.metric_name\"\n            }\n        }\n    },\n    {\n        \"to\": \"_tmp_metric_field\",\n        \"func\": {\n            \"valueRef\": {\n                \"path\": \"attributes.metric_value_field\"\n            }\n        }\n    },\n    {\n        \"to\": \"metric_value\",\n        \"func\": {\n            \"evaluate\": {\n                \"expr\": \"data[_tmp_metric_field]\"\n            }\n        }\n    },\n\n\n    {\n      \"from\": \"threshold\",\n      \"to\": \"threshold\"\n    }, \n    {\n      \"from\": \"md5\",\n      \"to\": \"md5\"\n    },\n{\n      \"from\": \"alert_type\",\n      \"to\": \"alertType\"\n    },{\n      \"from\": \"alert_name\",\n      \"to\": \"alert_name\"\n    },\n   {\n      \"to\": \"message\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"'Metric: ' + name + ' - '+ metric_name+ ' ' + (data.i_description if 'i_description' in data else '') + ' with value = ' + str(metric_value)  + ' of the device ip '  + assetIpAddress + ' violated threshold: ' + str(threshold)\"\n        }\n      }\n    },\n    {\n      \"to\": \"_tmp_timestamp\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"open_timestamp if state == 'OPEN' else clear_timestamp\"\n        },\n        \"datetime\": {\n          \"expr\": \"%Y-%m-%dT%H:%M:%S.%f\"\n        }\n      }\n    },\n    {\n      \"to\": \"raisedAt\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"_tmp_timestamp if state == 'OPEN' else 0\"\n        }\n      }\n    },\n    {\n      \"to\": \"clearedAt\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"_tmp_timestamp if state == 'CLEAR' else 0\"\n        }\n      }\n    },\n    {\n      \"from\": \"attributes\",\n      \"to\": \"severity\",\n      \"func\": {\n        \"valueRef\": {\n          \"path\": \"severity\"\n        }\n      }\n    },\n    {\n      \"from\": [\n        \"assetIpAddress\",\n        \"name\"\n      ],\n      \"to\": \"key\",\n      \"func\": {\n        \"join\": {\n          \"sep\": \"#\"\n        }\n      }      \n    }\n  ],\n  \"keepUnmapped\": false\n}",
    "attributes": null,
    "created": null,
    "updated": null,
    "creator": null,
    "updator": null
  }