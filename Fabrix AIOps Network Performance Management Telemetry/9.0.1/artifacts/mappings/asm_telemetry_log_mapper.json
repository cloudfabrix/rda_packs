{
    "description": "asm_telemetry_log",
    "sourcename": "asm_telemetry",
    "targetname": "OIA Alert",
    "sourceendpointtype": "webhook-basic",
    "sourcecategory": "alerts",
    "sourcetypeid": "OIA Alert",
    "targetendpointtype": "kafka-notification",
    "targetcategory": "alerts",
    "targettypeid": "OIA Alert",
    "sourcebundle": "default",
    "targetbundle": "default",
    "sourcemapper": "default.mapper-default-events-inbound-json",
    "sourceartifact": "events-inbound-default.json",
    "targetmapper": null,
    "sourcepipeline": "default.pipeline-inbound",
    "targetpipeline": null,
    "enabled": "Yes",
    "filters": null,
    "enrichment": null,
    "scriptinput": "{\r\n    \"alert_type\": \"log\",\r\n    \"alert_name\": \"test_device_availability\",\r\n    \"md5\": \"f93637ba755e844505b2b4a648480e7c\",\r\n    \"state\": \"OPEN\",\r\n    \"open_timestamp\": \"2025-08-19T12:58:25.253448\",\r\n    \"last_open_notification_timestamp\": \"2025-08-19T12:58:25.253448\",\r\n    \"data\": {\r\n        \"i_agent_host\": \"10.95.140.22\",\r\n        \"m_device_availability\": \"Down\",\r\n        \"count\": 31\r\n    },\r\n    \"attributes\": {\r\n        \"severity\": \"CRITICAL\",\r\n        \"metric_name\": \"device_availability\",\r\n        \"metric_value_field\": \"m_device_availability\"\r\n    }\r\n}",
    "mappingtype": "json",
    "mappingscript": "{\"conditions\": [\n    \"alert_type == 'log'\"\n  ],\n  \"mappings\": [\n    {\n      \"to\": \"sourceSystemType\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"'ASM'\"\n        }\n      }\n    },\n    {\n      \"from\": \"data\",\n      \"to\": \"assetIpAddress\",\n      \"func\": {\n        \"valueRef\": {\n          \"path\": \"i_agent_host\"\n        }\n      }\n    },\n    {\n      \"from\": \"data\",\n      \"to\": \"projectId\",\n      \"func\": {\n        \"valueRef\": {\n          \"path\": \"i_projectid\"\n        }\n      }\n    },\n    {\n      \"to\": \"metric_name\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"attributes.metric_name\"\n        }\n      }\n    },\n    {\n      \"to\": \"_tmp_metric_field\",\n      \"func\": {\n        \"valueRef\": {\n          \"path\": \"attributes.metric_value_field\"\n        }\n      }\n    },\n    {\n      \"to\": \"metric_value\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"data[_tmp_metric_field]\"\n        }\n      }\n    },\n    {\n      \"from\": \"threshold\",\n      \"to\": \"threshold\"\n    },\n    {\n      \"from\": \"md5\",\n      \"to\": \"md5\"\n    },\n    {\n      \"from\": \"alert_type\",\n      \"to\": \"alertType\"\n    },\n    {\n      \"from\": \"alert_name\",\n      \"to\": \"alert_name\"\n    },\n    {\n    \"to\": \"stack_name\", \n    \"func\": {\n      \"evaluate\": {\n        \"expr\": \"'cfx_rdaf_topology'\"\n      }\n    }\n  },\n   {\n      \"func\": {\n        \"graphdb_enrich\": {\n          \"name\": \"cfx_rdaf_topology\",\n          \"collection\": \"cfx_rdaf_topology_nodes\",\n          \"condition\": \"device_ip == '$assetIpAddress' and (customer_id is empty or customer_id is 'None' or customer_id is '$projectId')\",\n          \"enriched_columns\": {\n        \"node_id\": \"node_id\",\n        \"node_type\": \"node_type\",\n        \"node_label\": \"node_label\",\n        \"device_hostname_short\": \"asset_name\"\n\n      }\n        }\n      }\n    },\n    {\n  \"to\": \"message\",\n  \"func\": {\n    \"evaluate\": {\n      \"expr\": \"'Device ' + assetIpAddress + (' interface ' + data.i_description if 'i_description' in data else '') + ' is ' + str(metric_value) + ' for metric ' + metric_name\"\n    }\n  }\n}\n,\n    {\n      \"to\": \"_tmp_timestamp\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"open_timestamp if state == 'OPEN' else clear_timestamp\"\n        },\n        \"datetime\": {\n          \"expr\": \"%Y-%m-%dT%H:%M:%S.%f\"\n        }\n      }\n    },\n    {\n      \"to\": \"raisedAt\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"_tmp_timestamp if state == 'OPEN' else 0\"\n        }\n      }\n    },\n    {\n      \"to\": \"clearedAt\",\n      \"func\": {\n        \"evaluate\": {\n          \"expr\": \"_tmp_timestamp if state == 'CLEAR' else 0\"\n        }\n      }\n    },\n    {\n      \"from\": \"attributes\",\n      \"to\": \"severity\",\n      \"func\": {\n        \"valueRef\": {\n          \"path\": \"severity\"\n        }\n      }\n    },\n    {\n      \"from\": [\n        \"assetIpAddress\",\n        \"metric_name\"\n      ],\n      \"to\": \"key\",\n      \"func\": {\n        \"join\": {\n          \"sep\": \"#\"\n        }\n      }\n    }\n  ],\n  \"keepUnmapped\": false\n}\n",
    "attributes": null,
    "created": null,
    "updated": null,
    "creator": null,
    "updator": null
  }